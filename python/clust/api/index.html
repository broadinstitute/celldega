
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../pre/api/">
      
      
        <link rel="next" href="../../nbhd/api/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>clust - Celldega Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#clust-module-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Celldega Documentation" class="md-header__button md-logo" aria-label="Celldega Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Celldega Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              clust
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Celldega Documentation" class="md-nav__button md-logo" aria-label="Celldega Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Celldega Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../overview/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Overview
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../overview/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../overview/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../overview/file_formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Formats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../overview/usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Python API
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Python API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pre/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    clust
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    clust
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#celldega.clust" class="md-nav__link">
    <span class="md-ellipsis">
      clust
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.clust.Network" class="md-nav__link">
    <span class="md-ellipsis">
      Network
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.add_cats" class="md-nav__link">
    <span class="md-ellipsis">
      add_cats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.assess_prediction" class="md-nav__link">
    <span class="md-ellipsis">
      assess_prediction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.clip" class="md-nav__link">
    <span class="md-ellipsis">
      clip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.cluster" class="md-nav__link">
    <span class="md-ellipsis">
      cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.dat_to_df" class="md-nav__link">
    <span class="md-ellipsis">
      dat_to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.df_to_dat" class="md-nav__link">
    <span class="md-ellipsis">
      df_to_dat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.downsample" class="md-nav__link">
    <span class="md-ellipsis">
      downsample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.enrichrgram" class="md-nav__link">
    <span class="md-ellipsis">
      enrichrgram
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.export_df" class="md-nav__link">
    <span class="md-ellipsis">
      export_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.export_net_json" class="md-nav__link">
    <span class="md-ellipsis">
      export_net_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.export_viz_to_widget" class="md-nav__link">
    <span class="md-ellipsis">
      export_viz_to_widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_N_top" class="md-nav__link">
    <span class="md-ellipsis">
      filter_N_top
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_cat" class="md-nav__link">
    <span class="md-ellipsis">
      filter_cat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_names" class="md-nav__link">
    <span class="md-ellipsis">
      filter_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_sum" class="md-nav__link">
    <span class="md-ellipsis">
      filter_sum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_threshold" class="md-nav__link">
    <span class="md-ellipsis">
      filter_threshold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.generate_signatures" class="md-nav__link">
    <span class="md-ellipsis">
      generate_signatures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_data_file_to_net" class="md-nav__link">
    <span class="md-ellipsis">
      load_data_file_to_net
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_df" class="md-nav__link">
    <span class="md-ellipsis">
      load_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_file_as_string" class="md-nav__link">
    <span class="md-ellipsis">
      load_file_as_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_gene_exp_to_df" class="md-nav__link">
    <span class="md-ellipsis">
      load_gene_exp_to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_stdin" class="md-nav__link">
    <span class="md-ellipsis">
      load_stdin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_tsv_to_net" class="md-nav__link">
    <span class="md-ellipsis">
      load_tsv_to_net
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_vect_post_to_net" class="md-nav__link">
    <span class="md-ellipsis">
      load_vect_post_to_net
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.normalize" class="md-nav__link">
    <span class="md-ellipsis">
      normalize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.old_confusion_matrix_and_correct_series" class="md-nav__link">
    <span class="md-ellipsis">
      old_confusion_matrix_and_correct_series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.old_generate_signatures" class="md-nav__link">
    <span class="md-ellipsis">
      old_generate_signatures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.old_predict_cats_from_sigs" class="md-nav__link">
    <span class="md-ellipsis">
      old_predict_cats_from_sigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.predict_cats_from_sigs" class="md-nav__link">
    <span class="md-ellipsis">
      predict_cats_from_sigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.random_sample" class="md-nav__link">
    <span class="md-ellipsis">
      random_sample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.set_manual_category" class="md-nav__link">
    <span class="md-ellipsis">
      set_manual_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.sim_same_and_diff_category_samples" class="md-nav__link">
    <span class="md-ellipsis">
      sim_same_and_diff_category_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.swap_nan_for_zero" class="md-nav__link">
    <span class="md-ellipsis">
      swap_nan_for_zero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.widget" class="md-nav__link">
    <span class="md-ellipsis">
      widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.widget_df" class="md-nav__link">
    <span class="md-ellipsis">
      widget_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.write_json_to_file" class="md-nav__link">
    <span class="md-ellipsis">
      write_json_to_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.write_matrix_to_tsv" class="md-nav__link">
    <span class="md-ellipsis">
      write_matrix_to_tsv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.clust.hc" class="md-nav__link">
    <span class="md-ellipsis">
      hc
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nbhd/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nbhd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../viz/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    viz
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../javascript/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    JavaScript API
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            JavaScript API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../javascript/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../technologies/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Technologies
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Technologies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../gallery/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Gallery
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Gallery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Xenium
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Xenium
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gallery/gallery_xenium_mouse_brain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xenium Prime Mouse Brain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gallery/gallery_xenium_skin_cancer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xenium Prime Human Skin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gallery/gallery_xenium_multi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xenium Multi Dataset
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../examples/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Example Notebooks
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Example Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Brief Notebooks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Brief Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/brief_notebooks/Landscape_View_Xenium/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Landscape View Xenium
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/brief_notebooks/Landscape-Matrix_Xenium/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Landscape-Matrix Xenium
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/brief_notebooks/Pre-process_Xenium_V1_human_Pancreas_FFPE_outs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pre-process_Xenium_V1_human_Pancreas_FFPE_outs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#celldega.clust" class="md-nav__link">
    <span class="md-ellipsis">
      clust
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.clust.Network" class="md-nav__link">
    <span class="md-ellipsis">
      Network
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.add_cats" class="md-nav__link">
    <span class="md-ellipsis">
      add_cats
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.assess_prediction" class="md-nav__link">
    <span class="md-ellipsis">
      assess_prediction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.clip" class="md-nav__link">
    <span class="md-ellipsis">
      clip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.cluster" class="md-nav__link">
    <span class="md-ellipsis">
      cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.dat_to_df" class="md-nav__link">
    <span class="md-ellipsis">
      dat_to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.df_to_dat" class="md-nav__link">
    <span class="md-ellipsis">
      df_to_dat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.downsample" class="md-nav__link">
    <span class="md-ellipsis">
      downsample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.enrichrgram" class="md-nav__link">
    <span class="md-ellipsis">
      enrichrgram
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.export_df" class="md-nav__link">
    <span class="md-ellipsis">
      export_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.export_net_json" class="md-nav__link">
    <span class="md-ellipsis">
      export_net_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.export_viz_to_widget" class="md-nav__link">
    <span class="md-ellipsis">
      export_viz_to_widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_N_top" class="md-nav__link">
    <span class="md-ellipsis">
      filter_N_top
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_cat" class="md-nav__link">
    <span class="md-ellipsis">
      filter_cat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_names" class="md-nav__link">
    <span class="md-ellipsis">
      filter_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_sum" class="md-nav__link">
    <span class="md-ellipsis">
      filter_sum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.filter_threshold" class="md-nav__link">
    <span class="md-ellipsis">
      filter_threshold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.generate_signatures" class="md-nav__link">
    <span class="md-ellipsis">
      generate_signatures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_data_file_to_net" class="md-nav__link">
    <span class="md-ellipsis">
      load_data_file_to_net
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_df" class="md-nav__link">
    <span class="md-ellipsis">
      load_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_file" class="md-nav__link">
    <span class="md-ellipsis">
      load_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_file_as_string" class="md-nav__link">
    <span class="md-ellipsis">
      load_file_as_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_gene_exp_to_df" class="md-nav__link">
    <span class="md-ellipsis">
      load_gene_exp_to_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_stdin" class="md-nav__link">
    <span class="md-ellipsis">
      load_stdin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_tsv_to_net" class="md-nav__link">
    <span class="md-ellipsis">
      load_tsv_to_net
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.load_vect_post_to_net" class="md-nav__link">
    <span class="md-ellipsis">
      load_vect_post_to_net
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.normalize" class="md-nav__link">
    <span class="md-ellipsis">
      normalize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.old_confusion_matrix_and_correct_series" class="md-nav__link">
    <span class="md-ellipsis">
      old_confusion_matrix_and_correct_series
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.old_generate_signatures" class="md-nav__link">
    <span class="md-ellipsis">
      old_generate_signatures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.old_predict_cats_from_sigs" class="md-nav__link">
    <span class="md-ellipsis">
      old_predict_cats_from_sigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.predict_cats_from_sigs" class="md-nav__link">
    <span class="md-ellipsis">
      predict_cats_from_sigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.random_sample" class="md-nav__link">
    <span class="md-ellipsis">
      random_sample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.set_manual_category" class="md-nav__link">
    <span class="md-ellipsis">
      set_manual_category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.sim_same_and_diff_category_samples" class="md-nav__link">
    <span class="md-ellipsis">
      sim_same_and_diff_category_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.swap_nan_for_zero" class="md-nav__link">
    <span class="md-ellipsis">
      swap_nan_for_zero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.widget" class="md-nav__link">
    <span class="md-ellipsis">
      widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.widget_df" class="md-nav__link">
    <span class="md-ellipsis">
      widget_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.write_json_to_file" class="md-nav__link">
    <span class="md-ellipsis">
      write_json_to_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.clust.Network.write_matrix_to_tsv" class="md-nav__link">
    <span class="md-ellipsis">
      write_matrix_to_tsv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.clust.hc" class="md-nav__link">
    <span class="md-ellipsis">
      hc
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="clust-module-api-reference">Clust Module API Reference</h1>


<div class="doc doc-object doc-module">



<a id="celldega.clust"></a>
    <div class="doc doc-contents first">

      <p>Module for clustering high-dimensional data.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="celldega.clust.Network" class="doc doc-heading">
            <code>Network</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Clustergrammer.py takes a matrix as input (either from a file of a Pandas DataFrame), normalizes/filters, hierarchically clusters, and produces the :ref:<code>visualization_json</code> for :ref:<code>clustergrammer_js</code>.</p>
<p>Networks have two states:</p>
<ol>
<li>the data state, where they are stored as a matrix and nodes</li>
<li>the viz state where they are stored as viz.links, viz.row_nodes, and viz.col_nodes.</li>
</ol>
<p>The goal is to start in a data-state and produce a viz-state of
the network that will be used as input to clustergram.js.</p>

              <details class="quote">
                <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Network</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Clustergrammer.py takes a matrix as input (either from a file of a Pandas DataFrame), normalizes/filters, hierarchically clusters, and produces the :ref:`visualization_json` for :ref:`clustergrammer_js`.</span>

<span class="sd">  Networks have two states:</span>

<span class="sd">    1. the data state, where they are stored as a matrix and nodes</span>
<span class="sd">    2. the viz state where they are stored as viz.links, viz.row_nodes, and viz.col_nodes.</span>

<span class="sd">  The goal is to start in a data-state and produce a viz-state of</span>
<span class="sd">  the network that will be used as input to clustergram.js.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">initialize_net</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This re-initializes the Network object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">initialize_net</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load TSV file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">load_data</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">load_file_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_string</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load file as a string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">load_data</span><span class="o">.</span><span class="n">load_file_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_string</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">load_stdin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load stdin TSV-formatted string.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">load_data</span><span class="o">.</span><span class="n">load_stdin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">load_tsv_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_buffer</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This will load a TSV matrix file buffer; this is exposed so that it will</span>
<span class="sd">    be possible to load data without having to read from a file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">load_data</span><span class="o">.</span><span class="n">load_tsv_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_buffer</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">load_vect_post_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vect_post</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load data in the vector format JSON.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">load_vect_post</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vect_post</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">load_data_file_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load Clustergrammer&#39;s dat format (saved as JSON).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">inst_dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_json_to_dict</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">load_data</span><span class="o">.</span><span class="n">load_data_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst_dat</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">run_clustering</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">dendro</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">linkage_type</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">sim_mat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_sim</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">calc_cat_pval</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">run_enrichr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enrichrgram</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">clust_library</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The main function performs hierarchical clustering, optionally generates</span>
<span class="sd">    filtered views (e.g. row-filtered views), and generates the :</span>
<span class="sd">    ``visualization_json``.</span>

<span class="sd">    Used to set views equal to [&#39;N_row_sum&#39;, &#39;N_row_var&#39;]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">initialize_net</span><span class="o">.</span><span class="n">viz</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">make_clust_fun</span><span class="o">.</span><span class="n">make_clust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="n">dist_type</span><span class="p">,</span>
                                    <span class="n">run_clustering</span><span class="o">=</span><span class="n">run_clustering</span><span class="p">,</span>
                                    <span class="n">dendro</span><span class="o">=</span><span class="n">dendro</span><span class="p">,</span>
                                    <span class="n">requested_views</span><span class="o">=</span><span class="n">views</span><span class="p">,</span>
                                    <span class="n">linkage_type</span><span class="o">=</span><span class="n">linkage_type</span><span class="p">,</span>
                                    <span class="n">sim_mat</span><span class="o">=</span><span class="n">sim_mat</span><span class="p">,</span>
                                    <span class="n">filter_sim</span><span class="o">=</span><span class="n">filter_sim</span><span class="p">,</span>
                                    <span class="n">calc_cat_pval</span><span class="o">=</span><span class="n">calc_cat_pval</span><span class="p">,</span>
                                    <span class="n">run_enrichr</span><span class="o">=</span><span class="n">run_enrichr</span><span class="p">,</span>
                                    <span class="n">enrichrgram</span><span class="o">=</span><span class="n">enrichrgram</span><span class="p">,</span>
                                    <span class="n">clust_library</span><span class="o">=</span><span class="n">clust_library</span><span class="p">,</span>
                                    <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span>
                                    <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">swap_nan_for_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Swaps all NaN (numpy NaN) instances for zero.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="k">def</span> <span class="nf">load_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_ini</span><span class="p">,</span> <span class="n">meta_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">row_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_downsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">meta_ds_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">meta_ds_col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load Pandas DataFrame.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="c1"># load dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_ini</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">is_downsampled</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">meta_ds_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_ds_col</span> <span class="o">=</span> <span class="n">meta_ds_col</span>
      <span class="k">if</span> <span class="n">meta_ds_row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_ds_row</span> <span class="o">=</span> <span class="n">meta_ds_row</span>

    <span class="c1"># define downsampled status</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_downsampled</span> <span class="o">=</span> <span class="n">is_downsampled</span>
    <span class="c1"># print(&#39;load_df: is_downsampled&#39;, is_downsampled)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meta_col&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meta_row&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">meta_cat</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># load metadata</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_col</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">meta_col</span> <span class="o">=</span> <span class="n">meta_col</span>

      <span class="k">if</span> <span class="n">col_cats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_cats</span> <span class="o">=</span> <span class="n">meta_col</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_cats</span> <span class="o">=</span> <span class="n">col_cats</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">meta_cat</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_row</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">meta_row</span> <span class="o">=</span> <span class="n">meta_row</span>

      <span class="k">if</span> <span class="n">row_cats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_cats</span> <span class="o">=</span> <span class="n">meta_row</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_cats</span> <span class="o">=</span> <span class="n">row_cats</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">meta_cat</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">data_formats</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">define_cat_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">export_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Export Pandas DataFrame/</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># drop tuple categories if downsampling</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_downsampled</span><span class="p">:</span>
      <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="s1">&#39;col&#39;</span><span class="p">]</span>
      <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">df</span>

  <span class="k">def</span> <span class="nf">df_to_dat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">define_cat_colors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Load Pandas DataFrame (will be deprecated).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">data_formats</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">define_cat_colors</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">set_matrix_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">neg</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;matrix_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;matrix_colors&#39;</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;matrix_colors&#39;</span><span class="p">][</span><span class="s1">&#39;neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">neg</span>

  <span class="k">def</span> <span class="nf">set_global_cat_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">inst_name</span> <span class="ow">in</span> <span class="n">df_meta</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
      <span class="n">inst_color</span> <span class="o">=</span> <span class="n">df_meta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_name</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">]</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;global_cat_colors&#39;</span><span class="p">][</span><span class="n">inst_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_color</span>

  <span class="k">def</span> <span class="nf">set_cat_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cat_index</span><span class="p">,</span> <span class="n">cat_name</span><span class="p">,</span> <span class="n">inst_color</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;row&#39;</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;col&#39;</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="c1"># process cat_index</span>
      <span class="n">cat_index</span> <span class="o">=</span> <span class="n">cat_index</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="n">cat_index</span> <span class="o">=</span> <span class="s1">&#39;cat-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cat_index</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;cat_colors&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">][</span><span class="n">cat_index</span><span class="p">][</span><span class="n">cat_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_color</span>

    <span class="k">except</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;there was an error setting the category color&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">dat_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Export Pandas DataFrams (will be deprecated).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">export_net_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net_type</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;no-indent&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Export dat or viz JSON.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">export_data</span><span class="o">.</span><span class="n">export_net_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net_type</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">export_viz_to_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which_viz</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Export viz JSON, for use with clustergrammer_widget. Formerly method was</span>
<span class="sd">    named widget.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">export_data</span><span class="o">.</span><span class="n">export_net_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which_viz</span><span class="p">,</span> <span class="s1">&#39;no-indent&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which_viz</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">,</span> <span class="n">link_net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">link_net_js</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clust_library</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">,</span>
    <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate a widget visualization using the widget. The export_viz_to_widget</span>
<span class="sd">    method passes the visualization JSON to the instantiated widget, which is</span>
<span class="sd">    returned and visualized on the front-end.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># run clustering if necessary</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;row_nodes&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">clust_library</span><span class="o">=</span><span class="n">clust_library</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span>
                   <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">)</span>

      <span class="c1"># add manual_category to viz json</span>
      <span class="k">if</span> <span class="s1">&#39;manual_category&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">]</span>

      <span class="c1"># add pre-z-score data to viz</span>
      <span class="k">if</span> <span class="s1">&#39;pre_zscore&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;pre_zscore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;pre_zscore&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_class</span><span class="p">(</span><span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_viz_to_widget</span><span class="p">(</span><span class="n">which_viz</span><span class="p">))</span>

    <span class="c1"># initialize manual category</span>
    <span class="k">if</span> <span class="s1">&#39;manual_category&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">:</span>
      <span class="n">manual_cat</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;col&#39;</span>
      <span class="n">manual_cat</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">manual_cat</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;col_cat_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;cat_colors&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;cat-0&#39;</span><span class="p">]</span>

      <span class="n">man_cat_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
        <span class="n">manual_cat</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="n">man_cat_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_col</span><span class="p">[</span><span class="n">man_cat_name</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">manual_cat</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">manual_cat</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_manual_category</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;manual_cat&#39;</span><span class="p">)</span>

    <span class="c1"># add link (python)</span>
    <span class="k">if</span> <span class="n">link_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">inst_link</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">link</span><span class="p">(</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="p">,</span> <span class="s1">&#39;manual_cat&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="n">link_net</span><span class="o">.</span><span class="n">widget_instance</span><span class="p">,</span> <span class="s1">&#39;manual_cat&#39;</span><span class="p">)</span>
                               <span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">inst_link</span>

    <span class="c1"># add jslink (JavaScript)</span>
    <span class="k">if</span> <span class="n">link_net_js</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

      <span class="n">inst_link</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">(</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="p">,</span> <span class="s1">&#39;manual_cat&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="n">link_net_js</span><span class="o">.</span><span class="n">widget_instance</span><span class="p">,</span> <span class="s1">&#39;manual_cat&#39;</span><span class="p">)</span>
                               <span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">inst_link</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span>


  <span class="k">def</span> <span class="nf">widget_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Export a DataFrame from the front-end visualization. For instance, a user</span>
<span class="sd">    can filter to show only a single cluster using the dendrogram and then</span>
<span class="sd">    get a dataframe of this cluster using the widget_df method.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;widget_instance&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">mat_string</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>

        <span class="n">tmp_net</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Network</span><span class="p">())</span>

        <span class="n">df_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">mat_string</span>

        <span class="n">tmp_net</span><span class="o">.</span><span class="n">load_file_as_string</span><span class="p">(</span><span class="n">df_string</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">tmp_net</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">df</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;widget_class&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please make the widget before exporting the widget DataFrame.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Do this using the widget method: net.widget()&#39;</span><span class="p">)</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Can not make widget because Network has no attribute widget_class&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please instantiate Network with clustergrammer_widget using: Network(clustergrammer_widget)&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">write_json_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;no-indent&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Save dat or viz as a JSON to file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">export_data</span><span class="o">.</span><span class="n">write_json_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">write_matrix_to_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Export data-matrix to file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">export_data</span><span class="o">.</span><span class="n">write_matrix_to_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">filter_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">take_abs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Filter a network&#39;s rows or columns based on the sum across rows or columns.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">axis</span> <span class="o">=</span> <span class="n">inst_rc</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning inst_rc argument will be deprecated, please use axis&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">inst_rc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;please provide axis argument&#39;</span><span class="p">)</span>

    <span class="n">inst_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
      <span class="n">inst_df</span> <span class="o">=</span> <span class="n">run_filter</span><span class="o">.</span><span class="n">df_filter_row_sum</span><span class="p">(</span><span class="n">inst_df</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">take_abs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
      <span class="n">inst_df</span> <span class="o">=</span> <span class="n">run_filter</span><span class="o">.</span><span class="n">df_filter_col_sum</span><span class="p">(</span><span class="n">inst_df</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">take_abs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="n">inst_df</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">filter_N_top</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N_top</span><span class="p">,</span> <span class="n">rank_type</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Filter the matrix rows or columns based on sum/variance, and only keep the top</span>
<span class="sd">    N.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">axis</span> <span class="o">=</span> <span class="n">inst_rc</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning inst_rc argument will be deprecated, please use axis&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">inst_rc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;please provide axis argument&#39;</span><span class="p">)</span>

    <span class="n">inst_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">()</span>

    <span class="n">inst_df</span> <span class="o">=</span> <span class="n">run_filter</span><span class="o">.</span><span class="n">filter_N_top</span><span class="p">(</span><span class="n">inst_rc</span><span class="p">,</span> <span class="n">inst_df</span><span class="p">,</span> <span class="n">N_top</span><span class="p">,</span> <span class="n">rank_type</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="n">inst_df</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">filter_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">num_occur</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Filter the matrix rows or columns based on num_occur values being above a</span>
<span class="sd">    threshold (in absolute value).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">axis</span> <span class="o">=</span> <span class="n">inst_rc</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning inst_rc argument will be deprecated, please use axis&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">inst_rc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;please provide axis argument&#39;</span><span class="p">)</span>

    <span class="n">inst_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">()</span>

    <span class="n">inst_df</span> <span class="o">=</span> <span class="n">run_filter</span><span class="o">.</span><span class="n">filter_threshold</span><span class="p">(</span><span class="n">inst_df</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
      <span class="n">num_occur</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="n">inst_df</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">filter_cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cat_index</span><span class="p">,</span> <span class="n">cat_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Filter the matrix based on their category. cat_index is the index of the category, the first category has index=1.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">run_filter</span><span class="o">.</span><span class="n">filter_cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cat_index</span><span class="p">,</span> <span class="n">cat_name</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">filter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Filter the visualization using row/column names. The function takes, axis (&#39;row&#39;/&#39;col&#39;) and names, a list of strings.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">run_filter</span><span class="o">.</span><span class="n">filter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Trim values at input thresholds using pandas function</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm_type</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">z_clip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Normalize the matrix rows or columns using Z-score (zscore) or Quantile Normalization (qn). Users can optionally pass in a DataFrame to be normalized (and this will be incorporated into the Network object).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">normalize_fun</span><span class="o">.</span><span class="n">run_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">norm_type</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">z_clip</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">downsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ds_type</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">random_state</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">ds_name</span><span class="o">=</span><span class="s1">&#39;Downsample&#39;</span><span class="p">,</span>
                 <span class="n">ds_cluster_name</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Downsample the matrix rows or columns (currently supporting kmeans only). Users can optionally pass in a DataFrame to be downsampled (and this will be incorporated into the network object).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">downsample_fun</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">ds_name</span><span class="p">,</span> <span class="n">ds_cluster_name</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">random_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return random sample of matrix.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
      <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
      <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>  <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">add_cats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cat_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add categories to rows or columns using cat_data array of objects. Each object in cat_data is a dictionary with one key (category title) and value (rows/column names) that have this category. Categories will be added onto the existing categories and will be added in the order of the objects in the array.</span>

<span class="sd">    Example ``cat_data``::</span>


<span class="sd">        [</span>
<span class="sd">          {</span>
<span class="sd">            &quot;title&quot;: &quot;First Category&quot;,</span>
<span class="sd">            &quot;cats&quot;: {</span>
<span class="sd">              &quot;true&quot;: [</span>
<span class="sd">                &quot;ROS1&quot;,</span>
<span class="sd">                &quot;AAK1&quot;</span>
<span class="sd">              ]</span>
<span class="sd">            }</span>
<span class="sd">          },</span>
<span class="sd">          {</span>
<span class="sd">            &quot;title&quot;: &quot;Second Category&quot;,</span>
<span class="sd">            &quot;cats&quot;: {</span>
<span class="sd">              &quot;something&quot;: [</span>
<span class="sd">                &quot;PDK4&quot;</span>
<span class="sd">              ]</span>
<span class="sd">            }</span>
<span class="sd">          }</span>
<span class="sd">        ]</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">inst_data</span> <span class="ow">in</span> <span class="n">cat_data</span><span class="p">:</span>
      <span class="n">categories</span><span class="o">.</span><span class="n">add_cats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">inst_data</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">Iframe_web_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">):</span>

    <span class="n">link</span> <span class="o">=</span> <span class="n">iframe_web_app</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">link</span>

  <span class="k">def</span> <span class="nf">enrichrgram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add Enrichr gene enrichment results to your visualization (where your rows</span>
<span class="sd">    are genes). Run enrichrgram before clustering to incldue enrichment results</span>
<span class="sd">    as row categories. Enrichrgram can also be run on the front-end using the</span>
<span class="sd">    Enrichr logo at the top left.</span>

<span class="sd">    Set lib to the Enrichr library that you want to use for enrichment analysis.</span>
<span class="sd">    Libraries included:</span>

<span class="sd">      * ChEA_2016</span>
<span class="sd">      * KEA_2015</span>
<span class="sd">      * ENCODE_TF_ChIP-seq_2015</span>
<span class="sd">      * ENCODE_Histone_Modifications_2015</span>
<span class="sd">      * Disease_Perturbations_from_GEO_up</span>
<span class="sd">      * Disease_Perturbations_from_GEO_down</span>
<span class="sd">      * GO_Molecular_Function_2015</span>
<span class="sd">      * GO_Biological_Process_2015</span>
<span class="sd">      * GO_Cellular_Component_2015</span>
<span class="sd">      * Reactome_2016</span>
<span class="sd">      * KEGG_2016</span>
<span class="sd">      * MGI_Mammalian_Phenotype_Level_4</span>
<span class="sd">      * LINCS_L1000_Chem_Pert_up</span>
<span class="sd">      * LINCS_L1000_Chem_Pert_down</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">bar_info</span> <span class="o">=</span> <span class="n">enr_fun</span><span class="o">.</span><span class="n">add_enrichr_cats</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">lib</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;enrichrgram_lib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lib</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;row_cat_bars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bar_info</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">load_gmt</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">load_data</span><span class="o">.</span><span class="n">load_gmt</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">load_json_to_dict</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">load_data</span><span class="o">.</span><span class="n">load_json_to_dict</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">save_dict_to_json</span><span class="p">(</span><span class="n">inst_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;no-indent&#39;</span><span class="p">):</span>
    <span class="n">export_data</span><span class="o">.</span><span class="n">save_dict_to_json</span><span class="p">(</span><span class="n">inst_dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">load_gene_exp_to_df</span><span class="p">(</span><span class="n">inst_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Loads gene expression data from 10x in sparse matrix format and returns a</span>
<span class="sd">    Pandas dataframe</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
    <span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span> <span class="k">as</span> <span class="n">make_tuple</span>

    <span class="c1"># matrix</span>
    <span class="n">Matrix</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">mmread</span><span class="p">(</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;matrix.mtx&#39;</span><span class="p">)</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>

    <span class="c1"># genes</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;genes.tsv&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># # add unique id to all genes</span>
    <span class="c1"># genes = []</span>
    <span class="c1"># unique_id = 0</span>
    <span class="c1"># for inst_line in lines:</span>
    <span class="c1">#     inst_line = inst_line.strip().split()</span>

    <span class="c1">#     if len(inst_line) &gt; 1:</span>
    <span class="c1">#       inst_gene = inst_line[1]</span>
    <span class="c1">#     else:</span>
    <span class="c1">#       inst_gene = inst_line[0]</span>

    <span class="c1">#     genes.append(inst_gene + &#39;_&#39; + str(unique_id))</span>
    <span class="c1">#     unique_id = unique_id + 1</span>

    <span class="c1"># add unique id only to duplicate genes</span>
    <span class="n">ini_genes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inst_line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">inst_line</span> <span class="o">=</span> <span class="n">inst_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inst_line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">inst_gene</span> <span class="o">=</span> <span class="n">inst_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">inst_gene</span> <span class="o">=</span> <span class="n">inst_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ini_genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_gene</span><span class="p">)</span>

    <span class="n">gene_name_count</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ini_genes</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    <span class="n">duplicate_genes</span> <span class="o">=</span> <span class="n">gene_name_count</span><span class="p">[</span><span class="n">gene_name_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">dup_index</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">genes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inst_row</span> <span class="ow">in</span> <span class="n">ini_genes</span><span class="p">:</span>

      <span class="c1"># add index to non-unique genes</span>
      <span class="k">if</span> <span class="n">inst_row</span> <span class="ow">in</span> <span class="n">duplicate_genes</span><span class="p">:</span>

        <span class="c1"># calc_non-unque index</span>
        <span class="k">if</span> <span class="n">inst_row</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dup_index</span><span class="p">:</span>
          <span class="n">dup_index</span><span class="p">[</span><span class="n">inst_row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">dup_index</span><span class="p">[</span><span class="n">inst_row</span><span class="p">]</span> <span class="o">=</span> <span class="n">dup_index</span><span class="p">[</span><span class="n">inst_row</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">new_row</span> <span class="o">=</span> <span class="n">inst_row</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dup_index</span><span class="p">[</span><span class="n">inst_row</span><span class="p">])</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="n">inst_row</span>

      <span class="n">genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>

    <span class="c1"># barcodes</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;barcodes.tsv&#39;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">cell_barcodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inst_bc</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">inst_bc</span> <span class="o">=</span> <span class="n">inst_bc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># remove dash from barcodes if necessary</span>
        <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">inst_bc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
          <span class="n">inst_bc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_bc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">cell_barcodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_bc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># parse tuples if necessary</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cell_barcodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cell_barcodes</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">genes</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># make dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">genes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cell_barcodes</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">save_gene_exp_to_mtx_dir</span><span class="p">(</span><span class="n">inst_path</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inst_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">inst_path</span><span class="p">)</span>

    <span class="n">genes</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">barcodes</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">save_list_to_tsv</span><span class="p">(</span><span class="n">genes</span><span class="p">,</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;genes.tsv&#39;</span><span class="p">)</span>
    <span class="n">save_list_to_tsv</span><span class="p">(</span><span class="n">barcodes</span><span class="p">,</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;barcodes.tsv&#39;</span><span class="p">)</span>

    <span class="n">mat_ge</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span>
    <span class="n">mat_ge_sparse</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span><span class="n">mat_ge</span><span class="p">)</span>

    <span class="n">io</span><span class="o">.</span><span class="n">mmwrite</span><span class="p">(</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;matrix.mtx&#39;</span><span class="p">,</span> <span class="n">mat_ge_sparse</span><span class="p">)</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">save_list_to_tsv</span><span class="p">(</span><span class="n">inst_list</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

      <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">inst_line</span> <span class="ow">in</span> <span class="n">inst_list</span><span class="p">:</span>
          <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">inst_line</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

      <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">sim_same_and_diff_category_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">cat_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
                                         <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_roc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">precalc_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calc_roc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Calculate the similarity of samples from the same and different categories. The</span>
<span class="sd">      cat_index gives the index of the category, where 1 in the first category</span>
<span class="sd">      &#39;&#39;&#39;</span>

      <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">precalc_dist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
          <span class="c1"># compute distnace between rows (transpose to get cols as rows)</span>
          <span class="n">dist_arr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pdist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="n">dist_type</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">dist_arr</span> <span class="o">=</span> <span class="n">precalc_dist</span>

      <span class="c1"># generate sample names with categories</span>
      <span class="n">sample_combos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">2</span><span class="p">))</span>

      <span class="n">sample_names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_same&#39;</span> <span class="k">if</span> <span class="n">cols</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">cat_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">cols</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">cat_index</span><span class="p">]</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_different&#39;</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sample_combos</span><span class="p">)]</span>

      <span class="n">ser_dist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dist_arr</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">sample_names</span><span class="p">)</span>

      <span class="c1"># find same-cat sample comparisons</span>
      <span class="n">same_cat</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sample_names</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;same&#39;</span><span class="p">]</span>

      <span class="c1"># find diff-cat sample comparisons</span>
      <span class="n">diff_cat</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sample_names</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;different&#39;</span><span class="p">]</span>

      <span class="c1"># make series of same and diff category sample comparisons</span>
      <span class="n">ser_same</span> <span class="o">=</span> <span class="n">ser_dist</span><span class="p">[</span><span class="n">same_cat</span><span class="p">]</span>
      <span class="n">ser_same</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Same Category&#39;</span>
      <span class="n">ser_diff</span> <span class="o">=</span> <span class="n">ser_dist</span><span class="p">[</span><span class="n">diff_cat</span><span class="p">]</span>
      <span class="n">ser_diff</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Different Category&#39;</span>

      <span class="n">sim_dict</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">roc_data</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">sim_data</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;same&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_same</span>
      <span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_diff</span>

      <span class="n">pval_dict</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">ttest_stat</span><span class="p">,</span> <span class="n">pval_dict</span><span class="p">[</span><span class="s1">&#39;ttest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">ser_diff</span><span class="p">,</span> <span class="n">ser_same</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="n">equal_var</span><span class="p">)</span>

      <span class="n">ttest_stat</span><span class="p">,</span> <span class="n">pval_dict</span><span class="p">[</span><span class="s1">&#39;mannwhitney&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">ser_diff</span><span class="p">,</span> <span class="n">ser_same</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">calc_roc</span><span class="p">:</span>
          <span class="c1"># calc AUC</span>
          <span class="n">true_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;same&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
          <span class="n">false_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
          <span class="n">y_true</span> <span class="o">=</span> <span class="n">true_index</span> <span class="o">+</span> <span class="n">false_index</span>

          <span class="n">true_val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;same&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
          <span class="n">false_val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
          <span class="n">y_score</span> <span class="o">=</span> <span class="n">true_val</span> <span class="o">+</span> <span class="n">false_val</span>

          <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span><span class="p">)</span>

          <span class="n">inst_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

          <span class="k">if</span> <span class="n">plot_roc</span><span class="p">:</span>
              <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
              <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
              <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
              <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

              <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AUC&#39;</span><span class="p">,</span> <span class="n">inst_auc</span><span class="p">)</span>

          <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_true</span>
          <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_score</span>
          <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;fpr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpr</span>
          <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;tpr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpr</span>
          <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresholds</span>
          <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;auc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_auc</span>

      <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;sim_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_dict</span>
      <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;pval_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pval_dict</span>
      <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;roc_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_data</span>

      <span class="k">return</span> <span class="n">sim_data</span>

  <span class="k">def</span> <span class="nf">generate_signatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_data</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">,</span> <span class="n">category_name</span><span class="p">,</span> <span class="n">pval_cutoff</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                          <span class="n">num_top_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Generate signatures for column categories</span>
<span class="sd">      T-test is run for each category in a one-vs-all manner. The num_top_dims overrides</span>
<span class="sd">      the P-value cutoff.</span>
<span class="sd">      &#39;&#39;&#39;</span>

      <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

      <span class="c1"># remove columns (dimensions) with constant values</span>
      <span class="n">orig_num_cols</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="n">df_t</span> <span class="o">!=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>
      <span class="k">if</span> <span class="n">df_t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">orig_num_cols</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dropped columns with constant values&#39;</span><span class="p">)</span>

      <span class="c1"># make tuple rows</span>
      <span class="n">df_t</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">df_meta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">category_name</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
      <span class="n">category_level</span> <span class="o">=</span> <span class="mi">1</span>

      <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_tuple_to_multiindex</span><span class="p">(</span><span class="n">df_t</span><span class="p">)</span>

      <span class="n">cell_types</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">category_level</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())))</span>

      <span class="n">keep_genes</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">keep_genes_dict</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">gene_pval_dict</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">all_fold_info</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="k">for</span> <span class="n">inst_ct</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>

          <span class="n">inst_ct_mat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inst_ct</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span>
          <span class="n">inst_other_mat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">inst_ct</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span>

          <span class="c1"># save mean values and fold change</span>
          <span class="n">fold_info</span> <span class="o">=</span> <span class="p">{}</span>
          <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_ct_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
          <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_other_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
          <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span>
          <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">)</span>
          <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span>

          <span class="n">inst_stats</span><span class="p">,</span> <span class="n">inst_pvals</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">inst_ct_mat</span><span class="p">,</span> <span class="n">inst_other_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="n">equal_var</span><span class="p">)</span>

          <span class="n">ser_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">inst_pvals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

          <span class="k">if</span> <span class="n">num_top_dims</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
              <span class="n">ser_pval_keep</span> <span class="o">=</span> <span class="n">ser_pval</span><span class="p">[</span><span class="n">ser_pval</span> <span class="o">&lt;</span> <span class="n">pval_cutoff</span><span class="p">]</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">ser_pval_keep</span> <span class="o">=</span> <span class="n">ser_pval</span><span class="p">[:</span><span class="n">num_top_dims</span><span class="p">]</span>

          <span class="n">gene_pval_dict</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_pval_keep</span>

          <span class="n">inst_keep</span> <span class="o">=</span> <span class="n">ser_pval_keep</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
          <span class="n">keep_genes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inst_keep</span><span class="p">)</span>
          <span class="n">keep_genes_dict</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_keep</span>

      <span class="n">keep_genes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keep_genes</span><span class="p">)))</span>

      <span class="n">df_gbm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
      <span class="n">cols</span> <span class="o">=</span> <span class="n">df_gbm</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="n">df_sig</span> <span class="o">=</span> <span class="n">df_gbm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep_genes</span><span class="p">]</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep_genes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found no informative dimensions&#39;</span><span class="p">)</span>

      <span class="n">df_gene_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gene_pval_dict</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

      <span class="n">df_diff</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="n">inst_col</span> <span class="ow">in</span> <span class="n">df_gene_pval</span><span class="p">:</span>

          <span class="n">inst_pvals</span> <span class="o">=</span> <span class="n">df_gene_pval</span><span class="p">[</span><span class="n">inst_col</span><span class="p">]</span>

          <span class="c1"># nans represent dimensions that did not meet pval or top threshold</span>
          <span class="n">inst_pvals</span> <span class="o">=</span> <span class="n">inst_pvals</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

          <span class="n">inst_genes</span> <span class="o">=</span> <span class="n">inst_pvals</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

          <span class="c1"># prevent failure if no cells have this category</span>
          <span class="k">if</span> <span class="n">inst_pvals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
              <span class="n">rej</span><span class="p">,</span> <span class="n">pval_corr</span> <span class="o">=</span> <span class="n">smm</span><span class="o">.</span><span class="n">multipletests</span><span class="p">(</span><span class="n">inst_pvals</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fdr_bh&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>

              <span class="n">ser_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">inst_pvals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">inst_genes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;P-values&#39;</span><span class="p">)</span>
              <span class="n">ser_bh_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pval_corr</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">inst_genes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BH P-values&#39;</span><span class="p">)</span>
              <span class="n">ser_log2_fold</span> <span class="o">=</span> <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_col</span><span class="p">][</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_genes</span><span class="p">]</span>
              <span class="n">ser_log2_fold</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Log2 Fold Change&#39;</span>
              <span class="n">ser_cluster_mean</span> <span class="o">=</span> <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_col</span><span class="p">][</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_genes</span><span class="p">]</span>
              <span class="n">ser_cluster_mean</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Cluster Mean&#39;</span>
              <span class="n">ser_other_mean</span> <span class="o">=</span> <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_col</span><span class="p">][</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_genes</span><span class="p">]</span>
              <span class="n">ser_other_mean</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;All Other Mean&#39;</span>
              <span class="n">inst_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ser_pval</span><span class="p">,</span> <span class="n">ser_bh_pval</span><span class="p">,</span> <span class="n">ser_log2_fold</span><span class="p">,</span> <span class="n">ser_cluster_mean</span><span class="p">,</span> <span class="n">ser_other_mean</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

              <span class="n">df_diff</span><span class="p">[</span><span class="n">inst_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_df</span>

      <span class="k">return</span> <span class="n">df_sig</span><span class="p">,</span> <span class="n">df_diff</span>

  <span class="k">def</span> <span class="nf">old_generate_signatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_ini</span><span class="p">,</span> <span class="n">category_level</span><span class="p">,</span> <span class="n">pval_cutoff</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                          <span class="n">num_top_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">      </span><span class="sd">&#39;&#39;&#39; Generate signatures for column categories &#39;&#39;&#39;</span>

      <span class="c1"># change this to use category name and set caetgory level to 1 always</span>
      <span class="c1">###################################</span>

      <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_ini</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

      <span class="c1"># remove columns with constant values</span>
      <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="n">df_t</span> <span class="o">!=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>

      <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_tuple_to_multiindex</span><span class="p">(</span><span class="n">df_t</span><span class="p">)</span>

      <span class="n">cell_types</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">category_level</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())))</span>

      <span class="n">keep_genes</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">keep_genes_dict</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">gene_pval_dict</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">all_fold_info</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="k">for</span> <span class="n">inst_ct</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>

          <span class="n">inst_ct_mat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inst_ct</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span>
          <span class="n">inst_other_mat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">inst_ct</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span>

          <span class="c1"># save mean values and fold change</span>
          <span class="n">fold_info</span> <span class="o">=</span> <span class="p">{}</span>
          <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_ct_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
          <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_other_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
          <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span>
          <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">)</span>
          <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span>

          <span class="n">inst_stats</span><span class="p">,</span> <span class="n">inst_pvals</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">inst_ct_mat</span><span class="p">,</span> <span class="n">inst_other_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="n">equal_var</span><span class="p">)</span>

          <span class="n">ser_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">inst_pvals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

          <span class="k">if</span> <span class="n">num_top_dims</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
              <span class="n">ser_pval_keep</span> <span class="o">=</span> <span class="n">ser_pval</span><span class="p">[</span><span class="n">ser_pval</span> <span class="o">&lt;</span> <span class="n">pval_cutoff</span><span class="p">]</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">ser_pval_keep</span> <span class="o">=</span> <span class="n">ser_pval</span><span class="p">[:</span><span class="n">num_top_dims</span><span class="p">]</span>

          <span class="n">gene_pval_dict</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_pval_keep</span>

          <span class="n">inst_keep</span> <span class="o">=</span> <span class="n">ser_pval_keep</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
          <span class="n">keep_genes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inst_keep</span><span class="p">)</span>
          <span class="n">keep_genes_dict</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_keep</span>

      <span class="n">keep_genes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keep_genes</span><span class="p">)))</span>

      <span class="n">df_gbm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
      <span class="n">cols</span> <span class="o">=</span> <span class="n">df_gbm</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">inst_col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
          <span class="n">new_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">inst_col</span><span class="p">,</span> <span class="n">category_level</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">inst_col</span><span class="p">)</span>
          <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_col</span><span class="p">)</span>
      <span class="n">df_gbm</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_cols</span>

      <span class="n">df_sig</span> <span class="o">=</span> <span class="n">df_gbm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep_genes</span><span class="p">]</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep_genes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found no informative dimensions&#39;</span><span class="p">)</span>

      <span class="n">df_gene_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gene_pval_dict</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">df_sig</span><span class="p">,</span> <span class="n">df_gene_pval</span><span class="p">,</span> <span class="n">all_fold_info</span>

  <span class="k">def</span> <span class="nf">predict_cats_from_sigs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_data_ini</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">,</span> <span class="n">df_sig_ini</span><span class="p">,</span>
                             <span class="n">predict</span><span class="o">=</span><span class="s1">&#39;Predicted Category&#39;</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
                             <span class="n">unknown_thresh</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&#39;&#39;&#39; Predict category using signature &#39;&#39;&#39;</span>

      <span class="n">keep_rows</span> <span class="o">=</span> <span class="n">df_sig_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">data_rows</span> <span class="o">=</span> <span class="n">df_data_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="n">common_rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_rows</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keep_rows</span><span class="p">))</span>

      <span class="n">df_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_data_ini</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_rows</span><span class="p">])</span>
      <span class="n">df_sig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_sig_ini</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_rows</span><span class="p">])</span>

      <span class="c1"># calculate sim_mat of df_data and df_sig</span>
      <span class="n">cell_types</span> <span class="o">=</span> <span class="n">df_sig</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">barcodes</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">sim_mat</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">df_sig</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">df_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="n">dist_type</span><span class="p">)</span>
      <span class="n">df_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sim_mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">cell_types</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">barcodes</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

      <span class="c1"># get the top column value (most similar signature)</span>
      <span class="n">df_sim_top</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

      <span class="c1"># get the maximum similarity of a cell to a cell type definition</span>
      <span class="n">max_sim</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

      <span class="n">unknown_cells</span> <span class="o">=</span> <span class="n">max_sim</span><span class="p">[</span><span class="n">max_sim</span> <span class="o">&lt;</span> <span class="n">unknown_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="c1"># assign unknown cells (need category of same name)</span>
      <span class="n">df_sim_top</span><span class="p">[</span><span class="n">unknown_cells</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>

      <span class="c1"># add predicted category name to top list</span>
      <span class="c1"># top_list = df_sim_top.values</span>
      <span class="n">df_sim</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

      <span class="n">df_meta</span><span class="p">[</span><span class="n">predict</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sim_top</span>

      <span class="k">return</span> <span class="n">df_sim</span><span class="p">,</span> <span class="n">df_meta</span>


  <span class="k">def</span> <span class="nf">old_predict_cats_from_sigs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_data_ini</span><span class="p">,</span> <span class="n">df_sig_ini</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">predict_level</span><span class="o">=</span><span class="s1">&#39;Predict Category&#39;</span><span class="p">,</span>
                             <span class="n">truth_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">unknown_thresh</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&#39;&#39;&#39; Predict category using signature &#39;&#39;&#39;</span>

      <span class="n">keep_rows</span> <span class="o">=</span> <span class="n">df_sig_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">data_rows</span> <span class="o">=</span> <span class="n">df_data_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="n">common_rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_rows</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keep_rows</span><span class="p">))</span>

      <span class="n">df_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_data_ini</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_rows</span><span class="p">])</span>
      <span class="n">df_sig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_sig_ini</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_rows</span><span class="p">])</span>

      <span class="c1"># calculate sim_mat of df_data and df_sig</span>
      <span class="n">cell_types</span> <span class="o">=</span> <span class="n">df_sig</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">barcodes</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">sim_mat</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">df_sig</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">df_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="n">dist_type</span><span class="p">)</span>
      <span class="n">df_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sim_mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">cell_types</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">barcodes</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

      <span class="c1"># get the top column value (most similar signature)</span>
      <span class="n">df_sim_top</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

      <span class="c1"># get the maximum similarity of a cell to a cell type definition</span>
      <span class="n">max_sim</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

      <span class="n">unknown_cells</span> <span class="o">=</span> <span class="n">max_sim</span><span class="p">[</span><span class="n">max_sim</span> <span class="o">&lt;</span> <span class="n">unknown_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="c1"># assign unknown cells (need category of same name)</span>
      <span class="n">df_sim_top</span><span class="p">[</span><span class="n">unknown_cells</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>

      <span class="c1"># add predicted category name to top list</span>
      <span class="n">top_list</span> <span class="o">=</span> <span class="n">df_sim_top</span><span class="o">.</span><span class="n">values</span>
      <span class="n">top_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">predict_level</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">predict_level</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">x</span>  <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_list</span><span class="p">]</span>

      <span class="c1"># add cell type category to input data</span>
      <span class="n">df_cat</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
      <span class="n">cols</span> <span class="o">=</span> <span class="n">df_cat</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="c1"># check whether the columns have the true category available</span>
      <span class="n">has_truth</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
          <span class="n">has_truth</span> <span class="o">=</span> <span class="kc">True</span>

      <span class="k">if</span> <span class="n">has_truth</span><span class="p">:</span>
          <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">b</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">top_list</span><span class="p">)]</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">([</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">b</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">top_list</span><span class="p">)]</span>

      <span class="c1"># transfer new categories</span>
      <span class="n">df_cat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_cols</span>

      <span class="c1"># keep track of true and predicted labels</span>
      <span class="n">y_info</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="k">if</span> <span class="n">has_truth</span><span class="p">:</span>
          <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">truth_level</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
          <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_list</span><span class="p">]</span>

      <span class="k">return</span> <span class="n">df_cat</span><span class="p">,</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">y_info</span>

  <span class="k">def</span> <span class="nf">assess_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">,</span> <span class="n">truth</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&#39;&#39;&#39; Generate confusion matrix from y_info &#39;&#39;&#39;</span>

      <span class="n">y_info</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_meta</span><span class="p">[</span><span class="n">truth</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_meta</span><span class="p">[</span><span class="n">pred</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="n">sorted_cats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])))</span>
      <span class="n">conf_mat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">],</span> <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">)</span>

      <span class="c1"># true columns and pred rows</span>
      <span class="n">df_conf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

      <span class="n">total_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">df_conf</span><span class="p">)</span>
      <span class="n">total_pred</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
      <span class="n">fraction_correct</span> <span class="o">=</span> <span class="n">total_correct</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">total_pred</span><span class="p">)</span>

      <span class="c1"># calculate ser_correct</span>
      <span class="n">correct_list</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">cat_counts</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">all_cols</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">inst_cat</span> <span class="ow">in</span> <span class="n">all_cols</span><span class="p">:</span>
          <span class="n">inst_correct</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">,</span> <span class="n">inst_cat</span><span class="p">]</span> <span class="o">/</span> <span class="n">cat_counts</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">]</span>
          <span class="n">correct_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_correct</span><span class="p">)</span>

      <span class="n">ser_correct</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">correct_list</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">all_cols</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">df_conf</span><span class="p">,</span> <span class="n">ser_correct</span><span class="p">,</span> <span class="n">fraction_correct</span>

  <span class="k">def</span> <span class="nf">old_confusion_matrix_and_correct_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_info</span><span class="p">):</span>
<span class="w">      </span><span class="sd">&#39;&#39;&#39; Generate confusion matrix from y_info &#39;&#39;&#39;</span>


      <span class="n">a</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">])</span>
      <span class="n">true_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

      <span class="n">a</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])</span>
      <span class="n">pred_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

      <span class="n">sorted_cats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])))</span>
      <span class="n">conf_mat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">],</span> <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">],</span> <span class="n">sorted_cats</span><span class="p">)</span>
      <span class="n">df_conf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">)</span>

      <span class="n">total_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">df_conf</span><span class="p">)</span>
      <span class="n">total_pred</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
      <span class="n">fraction_correct</span> <span class="o">=</span> <span class="n">total_correct</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">total_pred</span><span class="p">)</span>

      <span class="c1"># calculate ser_correct</span>
      <span class="n">correct_list</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">cat_counts</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">all_cols</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">inst_cat</span> <span class="ow">in</span> <span class="n">all_cols</span><span class="p">:</span>
          <span class="n">inst_correct</span> <span class="o">=</span> <span class="n">df_conf</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">]</span> <span class="o">/</span> <span class="n">cat_counts</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">]</span>
          <span class="n">correct_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_correct</span><span class="p">)</span>

      <span class="n">ser_correct</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">correct_list</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">all_cols</span><span class="p">)</span>

      <span class="n">populations</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">populations</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_count</span>
      <span class="n">populations</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_count</span>

      <span class="k">return</span> <span class="n">df_conf</span><span class="p">,</span> <span class="n">populations</span><span class="p">,</span> <span class="n">ser_correct</span><span class="p">,</span> <span class="n">fraction_correct</span>

  <span class="k">def</span> <span class="nf">compare_performance_to_shuffled_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_data</span><span class="p">,</span> <span class="n">category_level</span><span class="p">,</span> <span class="n">num_shuffles</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                             <span class="n">random_seed</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">pval_cutoff</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
                                             <span class="n">num_top_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">predict_level</span><span class="o">=</span><span class="s1">&#39;Predict Category&#39;</span><span class="p">,</span>
                                             <span class="n">truth_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">unknown_thresh</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                             <span class="n">performance_type</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">):</span>
      <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>

      <span class="n">perform_list</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">num_shuffles</span> <span class="o">=</span> <span class="n">num_shuffles</span>

      <span class="c1"># pre-calculate the distance matrix (similarity matrix) if necessary</span>
      <span class="k">if</span> <span class="n">performance_type</span> <span class="o">==</span> <span class="s1">&#39;cat_sim_auc&#39;</span><span class="p">:</span>
          <span class="n">dist_arr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pdist</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="n">dist_type</span><span class="p">)</span>

      <span class="k">for</span> <span class="n">inst_run</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_shuffles</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

          <span class="n">cols</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
          <span class="n">rows</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
          <span class="n">mat</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">values</span>

          <span class="n">shuffled_cols</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
          <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shuffled_cols</span><span class="p">)</span>

          <span class="c1"># do not perform shuffling the first time to confirm that we get the same</span>
          <span class="c1"># results as the unshuffled dataaset</span>
          <span class="k">if</span> <span class="n">inst_run</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
              <span class="n">df_shuffle</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">df_shuffle</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">shuffled_cols</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>

          <span class="c1"># generate signature on shuffled data</span>
          <span class="n">df_sig</span><span class="p">,</span> <span class="n">keep_genes</span><span class="p">,</span> <span class="n">keep_genes_dict</span><span class="p">,</span> <span class="n">fold_info</span> <span class="o">=</span> <span class="n">generate_signatures</span><span class="p">(</span><span class="n">df_shuffle</span><span class="p">,</span>
                                                             <span class="n">category_level</span><span class="p">,</span>
                                                             <span class="n">pval_cutoff</span><span class="o">=</span><span class="n">pval_cutoff</span><span class="p">,</span>
                                                             <span class="n">num_top_dims</span><span class="o">=</span><span class="n">num_top_dims</span><span class="p">,</span>
                                                             <span class="n">equal_var</span><span class="o">=</span><span class="n">equal_var</span><span class="p">)</span>

          <span class="c1"># predictive performance</span>
          <span class="k">if</span> <span class="n">performance_type</span> <span class="o">==</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span>

              <span class="c1"># predict categories from signature</span>
              <span class="n">df_pred_cat</span><span class="p">,</span> <span class="n">df_sig_sim</span><span class="p">,</span> <span class="n">y_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_cats_from_sigs</span><span class="p">(</span><span class="n">df_shuffle</span><span class="p">,</span> <span class="n">df_sig</span><span class="p">,</span>
                  <span class="n">dist_type</span><span class="o">=</span><span class="n">dist_type</span><span class="p">,</span> <span class="n">predict_level</span><span class="o">=</span><span class="n">predict_level</span><span class="p">,</span> <span class="n">truth_level</span><span class="o">=</span><span class="n">truth_level</span><span class="p">,</span>
                  <span class="n">unknown_thresh</span><span class="o">=</span><span class="n">unknown_thresh</span><span class="p">)</span>

              <span class="c1"># calc confusion matrix and performance</span>
              <span class="n">df_conf</span><span class="p">,</span> <span class="n">populations</span><span class="p">,</span> <span class="n">ser_correct</span><span class="p">,</span> <span class="n">fraction_correct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">confusion_matrix_and_correct_series</span><span class="p">(</span><span class="n">y_info</span><span class="p">)</span>

              <span class="c1"># store performances of shuffles</span>
              <span class="k">if</span> <span class="n">inst_run</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                  <span class="n">perform_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fraction_correct</span><span class="p">)</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">real_performance</span> <span class="o">=</span> <span class="n">fraction_correct</span>
                  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;performance (fraction correct) of unshuffled: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fraction_correct</span><span class="p">))</span>

          <span class="k">elif</span> <span class="n">performance_type</span> <span class="o">==</span> <span class="s1">&#39;cat_sim_auc&#39;</span><span class="p">:</span>

              <span class="c1"># predict categories from signature</span>
              <span class="n">sim_dict</span><span class="p">,</span> <span class="n">pval_dict</span><span class="p">,</span> <span class="n">roc_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_same_and_diff_category_samples</span><span class="p">(</span><span class="n">df_shuffle</span><span class="p">,</span>
                  <span class="n">cat_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plot_roc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="n">equal_var</span><span class="p">,</span> <span class="n">precalc_dist</span><span class="o">=</span><span class="n">dist_arr</span><span class="p">)</span>

              <span class="c1"># store performances of shuffles</span>
              <span class="k">if</span> <span class="n">inst_run</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                  <span class="n">perform_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;auc&#39;</span><span class="p">])</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">real_performance</span> <span class="o">=</span> <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;auc&#39;</span><span class="p">]</span>
                  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;performance (category similarity auc) of unshuffled: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;auc&#39;</span><span class="p">]))</span>

      <span class="n">perform_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">perform_list</span><span class="p">)</span>

      <span class="n">in_top_fraction</span> <span class="o">=</span> <span class="n">perform_ser</span><span class="p">[</span><span class="n">perform_ser</span> <span class="o">&gt;</span> <span class="n">real_performance</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">num_shuffles</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;real data performs in the top &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">in_top_fraction</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f shuffled labels</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">perform_ser</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">box_scatter_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rand_seed</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
      <span class="n">dot_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">num_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
      <span class="n">start_title</span><span class="o">=</span><span class="s1">&#39;Variable Measurements Across&#39;</span><span class="p">,</span> <span class="n">end_title</span><span class="o">=</span><span class="s1">&#39;Groups&#39;</span><span class="p">,</span>
      <span class="n">group_list</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

      <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
      <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

      <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
      <span class="c1"># %matplotlib inline</span>

      <span class="k">if</span> <span class="n">columns</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
          <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
      <span class="n">figure_title</span> <span class="o">=</span> <span class="n">start_title</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">group</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">end_title</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">figure_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

      <span class="c1"># list of arranged dataframes</span>
      <span class="n">dfs</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="k">for</span> <span class="n">col_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)):</span>
          <span class="n">column</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="n">col_num</span><span class="p">]</span>
          <span class="n">plot_id</span> <span class="o">=</span> <span class="n">col_num</span> <span class="o">+</span> <span class="mi">1</span>

          <span class="c1"># group by column name or multiIndex name</span>
          <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
              <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>

          <span class="n">names</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">xs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="p">,[]</span>

          <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
              <span class="n">column_title</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">column_title</span> <span class="o">=</span> <span class="n">column</span>

          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">subdf</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grouped</span><span class="p">):</span>

              <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

              <span class="n">inst_ser</span> <span class="o">=</span> <span class="n">subdf</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>

              <span class="n">column_name</span> <span class="o">=</span> <span class="n">column_title</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

              <span class="n">inst_ser</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">column_name</span>
              <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_ser</span><span class="p">)</span>

              <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rand_seed</span><span class="p">)</span>
              <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="n">subdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

          <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_row</span><span class="p">,</span> <span class="n">num_col</span><span class="p">,</span> <span class="n">plot_id</span><span class="p">)</span>

          <span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>

          <span class="n">ngroup</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

          <span class="n">clevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">ngroup</span><span class="p">)</span>

          <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">clevel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">clevels</span><span class="p">):</span>

              <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_row</span><span class="p">,</span> <span class="n">num_col</span><span class="p">,</span> <span class="n">plot_id</span><span class="p">)</span>
              <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">dot_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>


          <span class="n">df_arranged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

          <span class="c1"># anova</span>
          <span class="n">anova_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_arranged</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_arranged</span><span class="p">]</span>
          <span class="n">f_val</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">f_oneway</span><span class="p">(</span><span class="o">*</span><span class="n">anova_data</span><span class="p">)</span>

          <span class="k">if</span> <span class="n">pval</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
              <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_title</span> <span class="o">+</span> <span class="s1">&#39; P-val: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pval</span><span class="p">))</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">pval</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">pval</span> <span class="o">*</span> <span class="mi">100000</span><span class="p">)</span><span class="o">/</span><span class="mi">100000</span>
              <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">column_title</span> <span class="o">+</span> <span class="s1">&#39; P-val: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pval</span><span class="p">))</span>

          <span class="n">dfs</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_arranged</span>

      <span class="k">return</span> <span class="n">dfs</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">rank_cols_by_anova_pval</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rand_seed</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dot_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">num_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)):</span>

      <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
      <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
      <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

      <span class="c1"># import matplotlib.pyplot as plt</span>
      <span class="c1"># %matplotlib inline</span>

      <span class="k">if</span> <span class="n">columns</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
          <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

      <span class="c1"># plt.figure(figsize=figsize)</span>

      <span class="c1"># list of arranged dataframes</span>
      <span class="n">dfs</span> <span class="o">=</span> <span class="p">{}</span>

      <span class="n">pval_list</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="k">for</span> <span class="n">col_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)):</span>
          <span class="n">column</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="n">col_num</span><span class="p">]</span>
          <span class="n">plot_id</span> <span class="o">=</span> <span class="n">col_num</span> <span class="o">+</span> <span class="mi">1</span>

          <span class="c1"># group by column name or multiIndex name</span>
          <span class="k">if</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
              <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>

          <span class="n">names</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">xs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="p">,[]</span>

          <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
              <span class="n">column_title</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">column_title</span> <span class="o">=</span> <span class="n">column</span>

          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">subdf</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grouped</span><span class="p">):</span>
              <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

              <span class="n">inst_ser</span> <span class="o">=</span> <span class="n">subdf</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>

              <span class="n">column_name</span> <span class="o">=</span> <span class="n">column_title</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

              <span class="n">inst_ser</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">column_name</span>
              <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_ser</span><span class="p">)</span>

              <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rand_seed</span><span class="p">)</span>
              <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="n">subdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>


          <span class="n">ngroup</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

          <span class="n">df_arranged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

          <span class="c1"># anova</span>
          <span class="n">anova_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_arranged</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_arranged</span><span class="p">]</span>
          <span class="n">f_val</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">f_oneway</span><span class="p">(</span><span class="o">*</span><span class="n">anova_data</span><span class="p">)</span>

          <span class="n">pval_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pval</span><span class="p">)</span>

      <span class="n">pval_ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pval_list</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
      <span class="n">pval_ser</span> <span class="o">=</span> <span class="n">pval_ser</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">pval_ser</span>


  <span class="k">def</span> <span class="nf">row_tuple_to_multiindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

      <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

      <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
      <span class="n">df_mi</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="n">df_mi</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
      <span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">inst_part</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>

          <span class="k">if</span> <span class="s1">&#39;: &#39;</span> <span class="ow">in</span> <span class="n">inst_part</span><span class="p">:</span>
              <span class="n">inst_title</span> <span class="o">=</span> <span class="n">inst_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">inst_title</span> <span class="o">=</span> <span class="s1">&#39;Name&#39;</span>
          <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_title</span><span class="p">)</span>

      <span class="n">new_rows</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">inst_row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
          <span class="n">inst_row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inst_row</span><span class="p">)</span>
          <span class="n">new_row</span> <span class="o">=</span> <span class="p">[]</span>
          <span class="k">for</span> <span class="n">inst_part</span> <span class="ow">in</span> <span class="n">inst_row</span><span class="p">:</span>
              <span class="k">if</span> <span class="s1">&#39;: &#39;</span> <span class="ow">in</span> <span class="n">inst_part</span><span class="p">:</span>
                  <span class="n">inst_part</span> <span class="o">=</span> <span class="n">inst_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
              <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_part</span><span class="p">)</span>
          <span class="n">new_row</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
          <span class="n">new_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>

      <span class="n">df_mi</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">new_rows</span>

      <span class="n">df_mi</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">df_mi</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">titles</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">df_mi</span>

  <span class="k">def</span> <span class="nf">set_cat_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat_colors</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cat_index</span><span class="p">,</span> <span class="n">cat_title</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">inst_ct</span> <span class="ow">in</span> <span class="n">cat_colors</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">cat_title</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
              <span class="n">cat_name</span> <span class="o">=</span> <span class="n">cat_title</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">inst_ct</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">cat_name</span> <span class="o">=</span> <span class="n">inst_ct</span>

          <span class="n">inst_color</span> <span class="o">=</span> <span class="n">cat_colors</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">set_cat_color</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">cat_index</span><span class="o">=</span><span class="n">cat_index</span><span class="p">,</span> <span class="n">cat_name</span><span class="o">=</span><span class="n">cat_name</span><span class="p">,</span> <span class="n">inst_color</span><span class="o">=</span><span class="n">inst_color</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">set_manual_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preferred_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This method is used to tell Clustergrammer2 that the user wants to define</span>
<span class="sd">    a manual category interactively using the dendrogram.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="s1">&#39;col&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>

    <span class="k">if</span> <span class="n">preferred_cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">pref_cats</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">inst_row</span> <span class="ow">in</span> <span class="n">preferred_cats</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
          <span class="n">inst_dict</span> <span class="o">=</span> <span class="p">{}</span>
          <span class="n">inst_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_row</span>
          <span class="n">inst_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preferred_cats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_row</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">]</span>
          <span class="n">pref_cats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_dict</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="s1">&#39;col_cats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pref_cats</span>

      <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="s1">&#39;row_cats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pref_cats</span>

  <span class="k">def</span> <span class="nf">ds_to_original_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="n">clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_ds_col</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">man_cat_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">inst_cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>

        <span class="c1"># get the manual category from the downsampled data</span>
        <span class="n">inst_man_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_ds_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_cluster</span><span class="p">,</span> <span class="n">man_cat_title</span><span class="p">]</span>

        <span class="c1"># find original labels that are assigned to this cluster</span>
        <span class="n">found_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_col</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_col</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">inst_cluster</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># update manual category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">found_labels</span><span class="p">,</span> <span class="n">man_cat_title</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_man_cat</span>

  <span class="k">def</span> <span class="nf">get_manual_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp</span><span class="p">):</span>


    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]:</span>

      <span class="k">try</span><span class="p">:</span>
      <span class="c1">###########################################################</span>

        <span class="n">export_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">inst_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">]</span>
        <span class="c1"># print(&#39;get get_manual_category&#39;, len(inst_nodes))</span>

        <span class="n">cat_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">]</span>

        <span class="c1"># Category Names</span>
        <span class="k">try</span><span class="p">:</span>
        <span class="c1">###########################################################</span>

          <span class="n">export_dict</span><span class="p">[</span><span class="n">cat_title</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">manual_cat</span><span class="p">)[</span><span class="n">axis</span><span class="p">][</span><span class="n">cat_title</span><span class="p">])</span>

          <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meta_cat&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_downsampled</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_row</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_nodes</span><span class="p">,</span> <span class="n">cat_title</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_dict</span><span class="p">[</span><span class="n">cat_title</span><span class="p">]</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_ds_row</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_nodes</span><span class="p">,</span> <span class="n">cat_title</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_dict</span><span class="p">[</span><span class="n">cat_title</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ds_to_original_meta</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_downsampled</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># print(&#39;&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &#39;)</span>
                <span class="c1"># print(export_dict[cat_title])</span>

                <span class="c1"># print(&#39;.. .. .. .. .. .. .. .. .. .. .. .. &#39;)</span>
                <span class="c1"># print(self.meta_col)</span>

                <span class="c1"># # for some reason this is breaking when trying to sync metadata</span>
                <span class="c1"># # switching to slower row based syncing</span>
                <span class="c1"># self.meta_col.loc[inst_nodes, cat_title] = export_dict[cat_title]</span>

                <span class="c1"># manually looping through rows in metadata works</span>
                <span class="k">for</span> <span class="n">inst_row</span> <span class="ow">in</span> <span class="n">export_dict</span><span class="p">[</span><span class="n">cat_title</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">meta_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_row</span><span class="p">,</span> <span class="n">cat_title</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_dict</span><span class="p">[</span><span class="n">cat_title</span><span class="p">][</span><span class="n">inst_row</span><span class="p">]</span>

                <span class="c1"># print(&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#39;)</span>
                <span class="c1"># print(self.meta_col)</span>

              <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta_ds_col</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_nodes</span><span class="p">,</span> <span class="n">cat_title</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_dict</span><span class="p">[</span><span class="n">cat_title</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ds_to_original_meta</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>


        <span class="k">except</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unable to load&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="p">,</span><span class="s1">&#39; category, please check title&#39;</span><span class="p">)</span>

        <span class="c1"># Category Colors</span>
        <span class="c1">#######################</span>
        <span class="n">export_dict</span><span class="p">[</span><span class="s1">&#39;cat_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">manual_cat</span><span class="p">)[</span><span class="s1">&#39;global_cat_colors&#39;</span><span class="p">]</span>

        <span class="c1"># # drop title from category colors</span>
        <span class="c1"># export_dict[&#39;cat_colors&#39;] = {}</span>
        <span class="c1"># for inst_cat in ini_new_colors:</span>
        <span class="c1">#   if (&#39;: &#39; in inst_cat):</span>
        <span class="c1">#     export_dict[&#39;cat_colors&#39;][inst_cat.split(&#39;: &#39;)[1]] = ini_new_colors[inst_cat]</span>
        <span class="c1">#   else:</span>
        <span class="c1">#     export_dict[&#39;cat_colors&#39;][inst_cat] = ini_new_colors[inst_cat]</span>

        <span class="c1"># if hasattr(self, &#39;meta_cat&#39;) == False:</span>
        <span class="c1">#   return export_dict</span>

      <span class="k">except</span><span class="p">:</span>
          <span class="c1"># print(&#39;failed to parse manual_category&#39;)</span>
          <span class="k">pass</span>


  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">umi_norm</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
      <span class="c1"># umi norm</span>
      <span class="n">barcode_umi_sum</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
      <span class="n">df_umi</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">barcode_umi_sum</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">df_umi</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">make_df_from_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
    <span class="n">inst_col</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">cat_titles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inst_info</span> <span class="ow">in</span> <span class="n">inst_col</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">inst_title</span> <span class="o">=</span> <span class="n">inst_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cat_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_title</span><span class="p">)</span>

    <span class="n">clean_cols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inst_col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="n">inst_clean</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">inst_info</span> <span class="ow">in</span> <span class="n">inst_col</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;: &#39;</span> <span class="ow">in</span> <span class="n">inst_info</span><span class="p">:</span>
                <span class="n">inst_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inst_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_info</span><span class="p">)</span>
        <span class="n">clean_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">inst_clean</span><span class="p">))</span>

    <span class="n">df_ini</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">clean_cols</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">df_ini</span><span class="o">.</span><span class="n">values</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">df_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">df_meta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cat_titles</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_meta</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.add_cats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_cats</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">cat_data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Add categories to rows or columns using cat_data array of objects. Each object in cat_data is a dictionary with one key (category title) and value (rows/column names) that have this category. Categories will be added onto the existing categories and will be added in the order of the objects in the array.</p>
<p>Example <code>cat_data</code>::</p>
<pre><code>[
  {
    "title": "First Category",
    "cats": {
      "true": [
        "ROS1",
        "AAK1"
      ]
    }
  },
  {
    "title": "Second Category",
    "cats": {
      "something": [
        "PDK4"
      ]
    }
  }
]
</code></pre>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_cats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cat_data</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Add categories to rows or columns using cat_data array of objects. Each object in cat_data is a dictionary with one key (category title) and value (rows/column names) that have this category. Categories will be added onto the existing categories and will be added in the order of the objects in the array.</span>

<span class="sd">  Example ``cat_data``::</span>


<span class="sd">      [</span>
<span class="sd">        {</span>
<span class="sd">          &quot;title&quot;: &quot;First Category&quot;,</span>
<span class="sd">          &quot;cats&quot;: {</span>
<span class="sd">            &quot;true&quot;: [</span>
<span class="sd">              &quot;ROS1&quot;,</span>
<span class="sd">              &quot;AAK1&quot;</span>
<span class="sd">            ]</span>
<span class="sd">          }</span>
<span class="sd">        },</span>
<span class="sd">        {</span>
<span class="sd">          &quot;title&quot;: &quot;Second Category&quot;,</span>
<span class="sd">          &quot;cats&quot;: {</span>
<span class="sd">            &quot;something&quot;: [</span>
<span class="sd">              &quot;PDK4&quot;</span>
<span class="sd">            ]</span>
<span class="sd">          }</span>
<span class="sd">        }</span>
<span class="sd">      ]</span>


<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">for</span> <span class="n">inst_data</span> <span class="ow">in</span> <span class="n">cat_data</span><span class="p">:</span>
    <span class="n">categories</span><span class="o">.</span><span class="n">add_cats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">inst_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.assess_prediction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assess_prediction</span><span class="p">(</span><span class="n">df_meta</span><span class="p">,</span> <span class="n">truth</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate confusion matrix from y_info</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assess_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">,</span> <span class="n">truth</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Generate confusion matrix from y_info &#39;&#39;&#39;</span>

    <span class="n">y_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_meta</span><span class="p">[</span><span class="n">truth</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_meta</span><span class="p">[</span><span class="n">pred</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">sorted_cats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])))</span>
    <span class="n">conf_mat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">],</span> <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">)</span>

    <span class="c1"># true columns and pred rows</span>
    <span class="n">df_conf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">total_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">df_conf</span><span class="p">)</span>
    <span class="n">total_pred</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">fraction_correct</span> <span class="o">=</span> <span class="n">total_correct</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">total_pred</span><span class="p">)</span>

    <span class="c1"># calculate ser_correct</span>
    <span class="n">correct_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cat_counts</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">all_cols</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">inst_cat</span> <span class="ow">in</span> <span class="n">all_cols</span><span class="p">:</span>
        <span class="n">inst_correct</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">,</span> <span class="n">inst_cat</span><span class="p">]</span> <span class="o">/</span> <span class="n">cat_counts</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">]</span>
        <span class="n">correct_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_correct</span><span class="p">)</span>

    <span class="n">ser_correct</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">correct_list</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">all_cols</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_conf</span><span class="p">,</span> <span class="n">ser_correct</span><span class="p">,</span> <span class="n">fraction_correct</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.clip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Trim values at input thresholds using pandas function</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Trim values at input thresholds using pandas function</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.cluster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cluster</span><span class="p">(</span><span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">run_clustering</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dendro</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="p">[],</span> <span class="n">linkage_type</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">sim_mat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_sim</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">calc_cat_pval</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">run_enrichr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enrichrgram</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clust_library</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>The main function performs hierarchical clustering, optionally generates
filtered views (e.g. row-filtered views), and generates the :
<code>visualization_json</code>.</p>
<p>Used to set views equal to ['N_row_sum', 'N_row_var']</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">run_clustering</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">dendro</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="p">[],</span>
               <span class="n">linkage_type</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">sim_mat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filter_sim</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
               <span class="n">calc_cat_pval</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">run_enrichr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enrichrgram</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">clust_library</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  The main function performs hierarchical clustering, optionally generates</span>
<span class="sd">  filtered views (e.g. row-filtered views), and generates the :</span>
<span class="sd">  ``visualization_json``.</span>

<span class="sd">  Used to set views equal to [&#39;N_row_sum&#39;, &#39;N_row_var&#39;]</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">initialize_net</span><span class="o">.</span><span class="n">viz</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="n">make_clust_fun</span><span class="o">.</span><span class="n">make_clust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="n">dist_type</span><span class="p">,</span>
                                  <span class="n">run_clustering</span><span class="o">=</span><span class="n">run_clustering</span><span class="p">,</span>
                                  <span class="n">dendro</span><span class="o">=</span><span class="n">dendro</span><span class="p">,</span>
                                  <span class="n">requested_views</span><span class="o">=</span><span class="n">views</span><span class="p">,</span>
                                  <span class="n">linkage_type</span><span class="o">=</span><span class="n">linkage_type</span><span class="p">,</span>
                                  <span class="n">sim_mat</span><span class="o">=</span><span class="n">sim_mat</span><span class="p">,</span>
                                  <span class="n">filter_sim</span><span class="o">=</span><span class="n">filter_sim</span><span class="p">,</span>
                                  <span class="n">calc_cat_pval</span><span class="o">=</span><span class="n">calc_cat_pval</span><span class="p">,</span>
                                  <span class="n">run_enrichr</span><span class="o">=</span><span class="n">run_enrichr</span><span class="p">,</span>
                                  <span class="n">enrichrgram</span><span class="o">=</span><span class="n">enrichrgram</span><span class="p">,</span>
                                  <span class="n">clust_library</span><span class="o">=</span><span class="n">clust_library</span><span class="p">,</span>
                                  <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span>
                                  <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.dat_to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dat_to_df</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Export Pandas DataFrams (will be deprecated).</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dat_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Export Pandas DataFrams (will be deprecated).</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">return</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.df_to_dat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">df_to_dat</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">define_cat_colors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load Pandas DataFrame (will be deprecated).</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">df_to_dat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">define_cat_colors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Load Pandas DataFrame (will be deprecated).</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">data_formats</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">define_cat_colors</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.downsample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">downsample</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ds_type</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">ds_name</span><span class="o">=</span><span class="s1">&#39;Downsample&#39;</span><span class="p">,</span> <span class="n">ds_cluster_name</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Downsample the matrix rows or columns (currently supporting kmeans only). Users can optionally pass in a DataFrame to be downsampled (and this will be incorporated into the network object).</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">downsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ds_type</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
               <span class="n">random_state</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">ds_name</span><span class="o">=</span><span class="s1">&#39;Downsample&#39;</span><span class="p">,</span>
               <span class="n">ds_cluster_name</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Downsample the matrix rows or columns (currently supporting kmeans only). Users can optionally pass in a DataFrame to be downsampled (and this will be incorporated into the network object).</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">return</span> <span class="n">downsample_fun</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ds_type</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">ds_name</span><span class="p">,</span> <span class="n">ds_cluster_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.enrichrgram" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enrichrgram</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Add Enrichr gene enrichment results to your visualization (where your rows
are genes). Run enrichrgram before clustering to incldue enrichment results
as row categories. Enrichrgram can also be run on the front-end using the
Enrichr logo at the top left.</p>
<p>Set lib to the Enrichr library that you want to use for enrichment analysis.
Libraries included:</p>
<ul>
<li>ChEA_2016</li>
<li>KEA_2015</li>
<li>ENCODE_TF_ChIP-seq_2015</li>
<li>ENCODE_Histone_Modifications_2015</li>
<li>Disease_Perturbations_from_GEO_up</li>
<li>Disease_Perturbations_from_GEO_down</li>
<li>GO_Molecular_Function_2015</li>
<li>GO_Biological_Process_2015</li>
<li>GO_Cellular_Component_2015</li>
<li>Reactome_2016</li>
<li>KEGG_2016</li>
<li>MGI_Mammalian_Phenotype_Level_4</li>
<li>LINCS_L1000_Chem_Pert_up</li>
<li>LINCS_L1000_Chem_Pert_down</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">enrichrgram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Add Enrichr gene enrichment results to your visualization (where your rows</span>
<span class="sd">  are genes). Run enrichrgram before clustering to incldue enrichment results</span>
<span class="sd">  as row categories. Enrichrgram can also be run on the front-end using the</span>
<span class="sd">  Enrichr logo at the top left.</span>

<span class="sd">  Set lib to the Enrichr library that you want to use for enrichment analysis.</span>
<span class="sd">  Libraries included:</span>

<span class="sd">    * ChEA_2016</span>
<span class="sd">    * KEA_2015</span>
<span class="sd">    * ENCODE_TF_ChIP-seq_2015</span>
<span class="sd">    * ENCODE_Histone_Modifications_2015</span>
<span class="sd">    * Disease_Perturbations_from_GEO_up</span>
<span class="sd">    * Disease_Perturbations_from_GEO_down</span>
<span class="sd">    * GO_Molecular_Function_2015</span>
<span class="sd">    * GO_Biological_Process_2015</span>
<span class="sd">    * GO_Cellular_Component_2015</span>
<span class="sd">    * Reactome_2016</span>
<span class="sd">    * KEGG_2016</span>
<span class="sd">    * MGI_Mammalian_Phenotype_Level_4</span>
<span class="sd">    * LINCS_L1000_Chem_Pert_up</span>
<span class="sd">    * LINCS_L1000_Chem_Pert_down</span>

<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>
  <span class="n">df</span><span class="p">,</span> <span class="n">bar_info</span> <span class="o">=</span> <span class="n">enr_fun</span><span class="o">.</span><span class="n">add_enrichr_cats</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">lib</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;enrichrgram_lib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lib</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;row_cat_bars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bar_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.export_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">export_df</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Export Pandas DataFrame/</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Export Pandas DataFrame/</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">data_formats</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="c1"># drop tuple categories if downsampling</span>
  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_downsampled</span><span class="p">:</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="s1">&#39;col&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.export_net_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">export_net_json</span><span class="p">(</span><span class="n">net_type</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;no-indent&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Export dat or viz JSON.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_net_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net_type</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;no-indent&#39;</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Export dat or viz JSON.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">return</span> <span class="n">export_data</span><span class="o">.</span><span class="n">export_net_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net_type</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.export_viz_to_widget" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">export_viz_to_widget</span><span class="p">(</span><span class="n">which_viz</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Export viz JSON, for use with clustergrammer_widget. Formerly method was
named widget.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_viz_to_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which_viz</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Export viz JSON, for use with clustergrammer_widget. Formerly method was</span>
<span class="sd">  named widget.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">return</span> <span class="n">export_data</span><span class="o">.</span><span class="n">export_net_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which_viz</span><span class="p">,</span> <span class="s1">&#39;no-indent&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.filter_N_top" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_N_top</span><span class="p">(</span><span class="n">N_top</span><span class="p">,</span> <span class="n">rank_type</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Filter the matrix rows or columns based on sum/variance, and only keep the top
N.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_N_top</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N_top</span><span class="p">,</span> <span class="n">rank_type</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Filter the matrix rows or columns based on sum/variance, and only keep the top</span>
<span class="sd">  N.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">inst_rc</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning inst_rc argument will be deprecated, please use axis&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inst_rc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;please provide axis argument&#39;</span><span class="p">)</span>

  <span class="n">inst_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">()</span>

  <span class="n">inst_df</span> <span class="o">=</span> <span class="n">run_filter</span><span class="o">.</span><span class="n">filter_N_top</span><span class="p">(</span><span class="n">inst_rc</span><span class="p">,</span> <span class="n">inst_df</span><span class="p">,</span> <span class="n">N_top</span><span class="p">,</span> <span class="n">rank_type</span><span class="p">)</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="n">inst_df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.filter_cat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_cat</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">cat_index</span><span class="p">,</span> <span class="n">cat_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Filter the matrix based on their category. cat_index is the index of the category, the first category has index=1.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cat_index</span><span class="p">,</span> <span class="n">cat_name</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Filter the matrix based on their category. cat_index is the index of the category, the first category has index=1.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">run_filter</span><span class="o">.</span><span class="n">filter_cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">cat_index</span><span class="p">,</span> <span class="n">cat_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.filter_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_names</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Filter the visualization using row/column names. The function takes, axis ('row'/'col') and names, a list of strings.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Filter the visualization using row/column names. The function takes, axis (&#39;row&#39;/&#39;col&#39;) and names, a list of strings.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">run_filter</span><span class="o">.</span><span class="n">filter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.filter_sum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_sum</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">take_abs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Filter a network's rows or columns based on the sum across rows or columns.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">take_abs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Filter a network&#39;s rows or columns based on the sum across rows or columns.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">inst_rc</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning inst_rc argument will be deprecated, please use axis&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inst_rc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;please provide axis argument&#39;</span><span class="p">)</span>

  <span class="n">inst_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
    <span class="n">inst_df</span> <span class="o">=</span> <span class="n">run_filter</span><span class="o">.</span><span class="n">df_filter_row_sum</span><span class="p">(</span><span class="n">inst_df</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">take_abs</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
    <span class="n">inst_df</span> <span class="o">=</span> <span class="n">run_filter</span><span class="o">.</span><span class="n">df_filter_col_sum</span><span class="p">(</span><span class="n">inst_df</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">take_abs</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="n">inst_df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.filter_threshold" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">num_occur</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Filter the matrix rows or columns based on num_occur values being above a
threshold (in absolute value).</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">num_occur</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inst_rc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Filter the matrix rows or columns based on num_occur values being above a</span>
<span class="sd">  threshold (in absolute value).</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">inst_rc</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning inst_rc argument will be deprecated, please use axis&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inst_rc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;please provide axis argument&#39;</span><span class="p">)</span>

  <span class="n">inst_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">()</span>

  <span class="n">inst_df</span> <span class="o">=</span> <span class="n">run_filter</span><span class="o">.</span><span class="n">filter_threshold</span><span class="p">(</span><span class="n">inst_df</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span>
    <span class="n">num_occur</span><span class="p">)</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="n">inst_df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.generate_signatures" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_signatures</span><span class="p">(</span><span class="n">df_data</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">,</span> <span class="n">category_name</span><span class="p">,</span> <span class="n">pval_cutoff</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">num_top_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate signatures for column categories
T-test is run for each category in a one-vs-all manner. The num_top_dims overrides
the P-value cutoff.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_signatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_data</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">,</span> <span class="n">category_name</span><span class="p">,</span> <span class="n">pval_cutoff</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                        <span class="n">num_top_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate signatures for column categories</span>
<span class="sd">    T-test is run for each category in a one-vs-all manner. The num_top_dims overrides</span>
<span class="sd">    the P-value cutoff.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="c1"># remove columns (dimensions) with constant values</span>
    <span class="n">orig_num_cols</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="n">df_t</span> <span class="o">!=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">df_t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">orig_num_cols</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dropped columns with constant values&#39;</span><span class="p">)</span>

    <span class="c1"># make tuple rows</span>
    <span class="n">df_t</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">df_meta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">category_name</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="n">category_level</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_tuple_to_multiindex</span><span class="p">(</span><span class="n">df_t</span><span class="p">)</span>

    <span class="n">cell_types</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">category_level</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())))</span>

    <span class="n">keep_genes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">keep_genes_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">gene_pval_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_fold_info</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">inst_ct</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>

        <span class="n">inst_ct_mat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inst_ct</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span>
        <span class="n">inst_other_mat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">inst_ct</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span>

        <span class="c1"># save mean values and fold change</span>
        <span class="n">fold_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_ct_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_other_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span>
        <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">)</span>
        <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span>

        <span class="n">inst_stats</span><span class="p">,</span> <span class="n">inst_pvals</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">inst_ct_mat</span><span class="p">,</span> <span class="n">inst_other_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="n">equal_var</span><span class="p">)</span>

        <span class="n">ser_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">inst_pvals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">num_top_dims</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">ser_pval_keep</span> <span class="o">=</span> <span class="n">ser_pval</span><span class="p">[</span><span class="n">ser_pval</span> <span class="o">&lt;</span> <span class="n">pval_cutoff</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ser_pval_keep</span> <span class="o">=</span> <span class="n">ser_pval</span><span class="p">[:</span><span class="n">num_top_dims</span><span class="p">]</span>

        <span class="n">gene_pval_dict</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_pval_keep</span>

        <span class="n">inst_keep</span> <span class="o">=</span> <span class="n">ser_pval_keep</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">keep_genes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inst_keep</span><span class="p">)</span>
        <span class="n">keep_genes_dict</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_keep</span>

    <span class="n">keep_genes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keep_genes</span><span class="p">)))</span>

    <span class="n">df_gbm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">df_gbm</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">df_sig</span> <span class="o">=</span> <span class="n">df_gbm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep_genes</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep_genes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found no informative dimensions&#39;</span><span class="p">)</span>

    <span class="n">df_gene_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gene_pval_dict</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">df_diff</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">inst_col</span> <span class="ow">in</span> <span class="n">df_gene_pval</span><span class="p">:</span>

        <span class="n">inst_pvals</span> <span class="o">=</span> <span class="n">df_gene_pval</span><span class="p">[</span><span class="n">inst_col</span><span class="p">]</span>

        <span class="c1"># nans represent dimensions that did not meet pval or top threshold</span>
        <span class="n">inst_pvals</span> <span class="o">=</span> <span class="n">inst_pvals</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

        <span class="n">inst_genes</span> <span class="o">=</span> <span class="n">inst_pvals</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># prevent failure if no cells have this category</span>
        <span class="k">if</span> <span class="n">inst_pvals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rej</span><span class="p">,</span> <span class="n">pval_corr</span> <span class="o">=</span> <span class="n">smm</span><span class="o">.</span><span class="n">multipletests</span><span class="p">(</span><span class="n">inst_pvals</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fdr_bh&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">ser_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">inst_pvals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">inst_genes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;P-values&#39;</span><span class="p">)</span>
            <span class="n">ser_bh_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pval_corr</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">inst_genes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BH P-values&#39;</span><span class="p">)</span>
            <span class="n">ser_log2_fold</span> <span class="o">=</span> <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_col</span><span class="p">][</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_genes</span><span class="p">]</span>
            <span class="n">ser_log2_fold</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Log2 Fold Change&#39;</span>
            <span class="n">ser_cluster_mean</span> <span class="o">=</span> <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_col</span><span class="p">][</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_genes</span><span class="p">]</span>
            <span class="n">ser_cluster_mean</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Cluster Mean&#39;</span>
            <span class="n">ser_other_mean</span> <span class="o">=</span> <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_col</span><span class="p">][</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_genes</span><span class="p">]</span>
            <span class="n">ser_other_mean</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;All Other Mean&#39;</span>
            <span class="n">inst_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ser_pval</span><span class="p">,</span> <span class="n">ser_bh_pval</span><span class="p">,</span> <span class="n">ser_log2_fold</span><span class="p">,</span> <span class="n">ser_cluster_mean</span><span class="p">,</span> <span class="n">ser_other_mean</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">df_diff</span><span class="p">[</span><span class="n">inst_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_df</span>

    <span class="k">return</span> <span class="n">df_sig</span><span class="p">,</span> <span class="n">df_diff</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.load_data_file_to_net" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_data_file_to_net</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load Clustergrammer's dat format (saved as JSON).</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_data_file_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Load Clustergrammer&#39;s dat format (saved as JSON).</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">inst_dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_json_to_dict</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
  <span class="n">load_data</span><span class="o">.</span><span class="n">load_data_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst_dat</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.load_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_df</span><span class="p">(</span><span class="n">df_ini</span><span class="p">,</span> <span class="n">meta_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_downsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">meta_ds_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta_ds_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load Pandas DataFrame.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_ini</span><span class="p">,</span> <span class="n">meta_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">meta_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">row_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_downsampled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">meta_ds_row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">meta_ds_col</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Load Pandas DataFrame.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

  <span class="c1"># load dataframe</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_ini</span><span class="p">)</span>


  <span class="k">if</span> <span class="n">is_downsampled</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">meta_ds_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">meta_ds_col</span> <span class="o">=</span> <span class="n">meta_ds_col</span>
    <span class="k">if</span> <span class="n">meta_ds_row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">meta_ds_row</span> <span class="o">=</span> <span class="n">meta_ds_row</span>

  <span class="c1"># define downsampled status</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">is_downsampled</span> <span class="o">=</span> <span class="n">is_downsampled</span>
  <span class="c1"># print(&#39;load_df: is_downsampled&#39;, is_downsampled)</span>

  <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meta_col&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meta_row&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta_cat</span> <span class="o">=</span> <span class="kc">False</span>

  <span class="c1"># load metadata</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_col</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta_col</span> <span class="o">=</span> <span class="n">meta_col</span>

    <span class="k">if</span> <span class="n">col_cats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">col_cats</span> <span class="o">=</span> <span class="n">meta_col</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">col_cats</span> <span class="o">=</span> <span class="n">col_cats</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">meta_cat</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_row</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta_row</span> <span class="o">=</span> <span class="n">meta_row</span>

    <span class="k">if</span> <span class="n">row_cats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">row_cats</span> <span class="o">=</span> <span class="n">meta_row</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">row_cats</span> <span class="o">=</span> <span class="n">row_cats</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">meta_cat</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="n">data_formats</span><span class="o">.</span><span class="n">df_to_dat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">define_cat_colors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.load_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load TSV file.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Load TSV file.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">load_data</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.load_file_as_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_file_as_string</span><span class="p">(</span><span class="n">file_string</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load file as a string.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_file_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_string</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Load file as a string.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">load_data</span><span class="o">.</span><span class="n">load_file_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_string</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.load_gene_exp_to_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_gene_exp_to_df</span><span class="p">(</span><span class="n">inst_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Loads gene expression data from 10x in sparse matrix format and returns a
Pandas dataframe</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">load_gene_exp_to_df</span><span class="p">(</span><span class="n">inst_path</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Loads gene expression data from 10x in sparse matrix format and returns a</span>
<span class="sd">  Pandas dataframe</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
  <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
  <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
  <span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span> <span class="k">as</span> <span class="n">make_tuple</span>

  <span class="c1"># matrix</span>
  <span class="n">Matrix</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">mmread</span><span class="p">(</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;matrix.mtx&#39;</span><span class="p">)</span>
  <span class="n">mat</span> <span class="o">=</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>

  <span class="c1"># genes</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;genes.tsv&#39;</span>
  <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
  <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

  <span class="c1"># # add unique id to all genes</span>
  <span class="c1"># genes = []</span>
  <span class="c1"># unique_id = 0</span>
  <span class="c1"># for inst_line in lines:</span>
  <span class="c1">#     inst_line = inst_line.strip().split()</span>

  <span class="c1">#     if len(inst_line) &gt; 1:</span>
  <span class="c1">#       inst_gene = inst_line[1]</span>
  <span class="c1">#     else:</span>
  <span class="c1">#       inst_gene = inst_line[0]</span>

  <span class="c1">#     genes.append(inst_gene + &#39;_&#39; + str(unique_id))</span>
  <span class="c1">#     unique_id = unique_id + 1</span>

  <span class="c1"># add unique id only to duplicate genes</span>
  <span class="n">ini_genes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">inst_line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
      <span class="n">inst_line</span> <span class="o">=</span> <span class="n">inst_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inst_line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">inst_gene</span> <span class="o">=</span> <span class="n">inst_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">inst_gene</span> <span class="o">=</span> <span class="n">inst_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">ini_genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_gene</span><span class="p">)</span>

  <span class="n">gene_name_count</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ini_genes</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
  <span class="n">duplicate_genes</span> <span class="o">=</span> <span class="n">gene_name_count</span><span class="p">[</span><span class="n">gene_name_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

  <span class="n">dup_index</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">genes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">inst_row</span> <span class="ow">in</span> <span class="n">ini_genes</span><span class="p">:</span>

    <span class="c1"># add index to non-unique genes</span>
    <span class="k">if</span> <span class="n">inst_row</span> <span class="ow">in</span> <span class="n">duplicate_genes</span><span class="p">:</span>

      <span class="c1"># calc_non-unque index</span>
      <span class="k">if</span> <span class="n">inst_row</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dup_index</span><span class="p">:</span>
        <span class="n">dup_index</span><span class="p">[</span><span class="n">inst_row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dup_index</span><span class="p">[</span><span class="n">inst_row</span><span class="p">]</span> <span class="o">=</span> <span class="n">dup_index</span><span class="p">[</span><span class="n">inst_row</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="n">new_row</span> <span class="o">=</span> <span class="n">inst_row</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dup_index</span><span class="p">[</span><span class="n">inst_row</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">new_row</span> <span class="o">=</span> <span class="n">inst_row</span>

    <span class="n">genes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>

  <span class="c1"># barcodes</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="n">inst_path</span> <span class="o">+</span> <span class="s1">&#39;barcodes.tsv&#39;</span>
  <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
  <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

  <span class="n">cell_barcodes</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">inst_bc</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
      <span class="n">inst_bc</span> <span class="o">=</span> <span class="n">inst_bc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

      <span class="c1"># remove dash from barcodes if necessary</span>
      <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">inst_bc</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">inst_bc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_bc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

      <span class="n">cell_barcodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_bc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

  <span class="c1"># parse tuples if necessary</span>
  <span class="k">try</span><span class="p">:</span>
      <span class="n">cell_barcodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cell_barcodes</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
      <span class="k">pass</span>

  <span class="k">try</span><span class="p">:</span>
      <span class="n">genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">genes</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
      <span class="k">pass</span>

  <span class="c1"># make dataframe</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">genes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cell_barcodes</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.load_stdin" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_stdin</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load stdin TSV-formatted string.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_stdin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Load stdin TSV-formatted string.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">load_data</span><span class="o">.</span><span class="n">load_stdin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.load_tsv_to_net" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_tsv_to_net</span><span class="p">(</span><span class="n">file_buffer</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>This will load a TSV matrix file buffer; this is exposed so that it will
be possible to load data without having to read from a file.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_tsv_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_buffer</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  This will load a TSV matrix file buffer; this is exposed so that it will</span>
<span class="sd">  be possible to load data without having to read from a file.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">load_data</span><span class="o">.</span><span class="n">load_tsv_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_buffer</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.load_vect_post_to_net" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_vect_post_to_net</span><span class="p">(</span><span class="n">vect_post</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load data in the vector format JSON.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_vect_post_to_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vect_post</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Load data in the vector format JSON.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">load_vect_post</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vect_post</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.normalize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm_type</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">z_clip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Normalize the matrix rows or columns using Z-score (zscore) or Quantile Normalization (qn). Users can optionally pass in a DataFrame to be normalized (and this will be incorporated into the Network object).</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm_type</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">z_clip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Normalize the matrix rows or columns using Z-score (zscore) or Quantile Normalization (qn). Users can optionally pass in a DataFrame to be normalized (and this will be incorporated into the Network object).</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">normalize_fun</span><span class="o">.</span><span class="n">run_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">norm_type</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">z_clip</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.old_confusion_matrix_and_correct_series" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">old_confusion_matrix_and_correct_series</span><span class="p">(</span><span class="n">y_info</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate confusion matrix from y_info</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">old_confusion_matrix_and_correct_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_info</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Generate confusion matrix from y_info &#39;&#39;&#39;</span>


    <span class="n">a</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">])</span>
    <span class="n">true_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])</span>
    <span class="n">pred_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="n">sorted_cats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])))</span>
    <span class="n">conf_mat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">],</span> <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">],</span> <span class="n">sorted_cats</span><span class="p">)</span>
    <span class="n">df_conf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sorted_cats</span><span class="p">)</span>

    <span class="n">total_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">df_conf</span><span class="p">)</span>
    <span class="n">total_pred</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">fraction_correct</span> <span class="o">=</span> <span class="n">total_correct</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">total_pred</span><span class="p">)</span>

    <span class="c1"># calculate ser_correct</span>
    <span class="n">correct_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cat_counts</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">all_cols</span> <span class="o">=</span> <span class="n">df_conf</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">inst_cat</span> <span class="ow">in</span> <span class="n">all_cols</span><span class="p">:</span>
        <span class="n">inst_correct</span> <span class="o">=</span> <span class="n">df_conf</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">]</span> <span class="o">/</span> <span class="n">cat_counts</span><span class="p">[</span><span class="n">inst_cat</span><span class="p">]</span>
        <span class="n">correct_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_correct</span><span class="p">)</span>

    <span class="n">ser_correct</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">correct_list</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">all_cols</span><span class="p">)</span>

    <span class="n">populations</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">populations</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_count</span>
    <span class="n">populations</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_count</span>

    <span class="k">return</span> <span class="n">df_conf</span><span class="p">,</span> <span class="n">populations</span><span class="p">,</span> <span class="n">ser_correct</span><span class="p">,</span> <span class="n">fraction_correct</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.old_generate_signatures" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">old_generate_signatures</span><span class="p">(</span><span class="n">df_ini</span><span class="p">,</span> <span class="n">category_level</span><span class="p">,</span> <span class="n">pval_cutoff</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">num_top_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate signatures for column categories</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">old_generate_signatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_ini</span><span class="p">,</span> <span class="n">category_level</span><span class="p">,</span> <span class="n">pval_cutoff</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                        <span class="n">num_top_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39; Generate signatures for column categories &#39;&#39;&#39;</span>

    <span class="c1"># change this to use category name and set caetgory level to 1 always</span>
    <span class="c1">###################################</span>

    <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_ini</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="c1"># remove columns with constant values</span>
    <span class="n">df_t</span> <span class="o">=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="n">df_t</span> <span class="o">!=</span> <span class="n">df_t</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_tuple_to_multiindex</span><span class="p">(</span><span class="n">df_t</span><span class="p">)</span>

    <span class="n">cell_types</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">category_level</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())))</span>

    <span class="n">keep_genes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">keep_genes_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">gene_pval_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_fold_info</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">inst_ct</span> <span class="ow">in</span> <span class="n">cell_types</span><span class="p">:</span>

        <span class="n">inst_ct_mat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inst_ct</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span>
        <span class="n">inst_other_mat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">inst_ct</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span>

        <span class="c1"># save mean values and fold change</span>
        <span class="n">fold_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_ct_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_other_mat</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;cluster_mean&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;other_mean&#39;</span><span class="p">]</span>
        <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span><span class="p">[</span><span class="s1">&#39;log2_fold&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">)</span>
        <span class="n">all_fold_info</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">fold_info</span>

        <span class="n">inst_stats</span><span class="p">,</span> <span class="n">inst_pvals</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">inst_ct_mat</span><span class="p">,</span> <span class="n">inst_other_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="n">equal_var</span><span class="p">)</span>

        <span class="n">ser_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">inst_pvals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">num_top_dims</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">ser_pval_keep</span> <span class="o">=</span> <span class="n">ser_pval</span><span class="p">[</span><span class="n">ser_pval</span> <span class="o">&lt;</span> <span class="n">pval_cutoff</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ser_pval_keep</span> <span class="o">=</span> <span class="n">ser_pval</span><span class="p">[:</span><span class="n">num_top_dims</span><span class="p">]</span>

        <span class="n">gene_pval_dict</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_pval_keep</span>

        <span class="n">inst_keep</span> <span class="o">=</span> <span class="n">ser_pval_keep</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">keep_genes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inst_keep</span><span class="p">)</span>
        <span class="n">keep_genes_dict</span><span class="p">[</span><span class="n">inst_ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_keep</span>

    <span class="n">keep_genes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keep_genes</span><span class="p">)))</span>

    <span class="n">df_gbm</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">category_level</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">df_gbm</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inst_col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="n">new_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">inst_col</span><span class="p">,</span> <span class="n">category_level</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">inst_col</span><span class="p">)</span>
        <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_col</span><span class="p">)</span>
    <span class="n">df_gbm</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_cols</span>

    <span class="n">df_sig</span> <span class="o">=</span> <span class="n">df_gbm</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep_genes</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep_genes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found no informative dimensions&#39;</span><span class="p">)</span>

    <span class="n">df_gene_pval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gene_pval_dict</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_sig</span><span class="p">,</span> <span class="n">df_gene_pval</span><span class="p">,</span> <span class="n">all_fold_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.old_predict_cats_from_sigs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">old_predict_cats_from_sigs</span><span class="p">(</span><span class="n">df_data_ini</span><span class="p">,</span> <span class="n">df_sig_ini</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">predict_level</span><span class="o">=</span><span class="s1">&#39;Predict Category&#39;</span><span class="p">,</span> <span class="n">truth_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">unknown_thresh</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Predict category using signature</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">old_predict_cats_from_sigs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_data_ini</span><span class="p">,</span> <span class="n">df_sig_ini</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">predict_level</span><span class="o">=</span><span class="s1">&#39;Predict Category&#39;</span><span class="p">,</span>
                           <span class="n">truth_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">unknown_thresh</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Predict category using signature &#39;&#39;&#39;</span>

    <span class="n">keep_rows</span> <span class="o">=</span> <span class="n">df_sig_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">data_rows</span> <span class="o">=</span> <span class="n">df_data_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">common_rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_rows</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keep_rows</span><span class="p">))</span>

    <span class="n">df_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_data_ini</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_rows</span><span class="p">])</span>
    <span class="n">df_sig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_sig_ini</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_rows</span><span class="p">])</span>

    <span class="c1"># calculate sim_mat of df_data and df_sig</span>
    <span class="n">cell_types</span> <span class="o">=</span> <span class="n">df_sig</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">barcodes</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">sim_mat</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">df_sig</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">df_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="n">dist_type</span><span class="p">)</span>
    <span class="n">df_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sim_mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">cell_types</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">barcodes</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="c1"># get the top column value (most similar signature)</span>
    <span class="n">df_sim_top</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># get the maximum similarity of a cell to a cell type definition</span>
    <span class="n">max_sim</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">unknown_cells</span> <span class="o">=</span> <span class="n">max_sim</span><span class="p">[</span><span class="n">max_sim</span> <span class="o">&lt;</span> <span class="n">unknown_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># assign unknown cells (need category of same name)</span>
    <span class="n">df_sim_top</span><span class="p">[</span><span class="n">unknown_cells</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>

    <span class="c1"># add predicted category name to top list</span>
    <span class="n">top_list</span> <span class="o">=</span> <span class="n">df_sim_top</span><span class="o">.</span><span class="n">values</span>
    <span class="n">top_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">predict_level</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="n">predict_level</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">x</span>  <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_list</span><span class="p">]</span>

    <span class="c1"># add cell type category to input data</span>
    <span class="n">df_cat</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_data</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">df_cat</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># check whether the columns have the true category available</span>
    <span class="n">has_truth</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="n">has_truth</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">has_truth</span><span class="p">:</span>
        <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">b</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">top_list</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">([</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">b</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">top_list</span><span class="p">)]</span>

    <span class="c1"># transfer new categories</span>
    <span class="n">df_cat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_cols</span>

    <span class="c1"># keep track of true and predicted labels</span>
    <span class="n">y_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">has_truth</span><span class="p">:</span>
        <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">truth_level</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
        <span class="n">y_info</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_list</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">df_cat</span><span class="p">,</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">y_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.predict_cats_from_sigs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict_cats_from_sigs</span><span class="p">(</span><span class="n">df_data_ini</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">,</span> <span class="n">df_sig_ini</span><span class="p">,</span> <span class="n">predict</span><span class="o">=</span><span class="s1">&#39;Predicted Category&#39;</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">unknown_thresh</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Predict category using signature</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict_cats_from_sigs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_data_ini</span><span class="p">,</span> <span class="n">df_meta</span><span class="p">,</span> <span class="n">df_sig_ini</span><span class="p">,</span>
                           <span class="n">predict</span><span class="o">=</span><span class="s1">&#39;Predicted Category&#39;</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
                           <span class="n">unknown_thresh</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Predict category using signature &#39;&#39;&#39;</span>

    <span class="n">keep_rows</span> <span class="o">=</span> <span class="n">df_sig_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">data_rows</span> <span class="o">=</span> <span class="n">df_data_ini</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">common_rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_rows</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keep_rows</span><span class="p">))</span>

    <span class="n">df_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_data_ini</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_rows</span><span class="p">])</span>
    <span class="n">df_sig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">df_sig_ini</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_rows</span><span class="p">])</span>

    <span class="c1"># calculate sim_mat of df_data and df_sig</span>
    <span class="n">cell_types</span> <span class="o">=</span> <span class="n">df_sig</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">barcodes</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">sim_mat</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">df_sig</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">df_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="n">dist_type</span><span class="p">)</span>
    <span class="n">df_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sim_mat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">cell_types</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">barcodes</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="c1"># get the top column value (most similar signature)</span>
    <span class="n">df_sim_top</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># get the maximum similarity of a cell to a cell type definition</span>
    <span class="n">max_sim</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">unknown_cells</span> <span class="o">=</span> <span class="n">max_sim</span><span class="p">[</span><span class="n">max_sim</span> <span class="o">&lt;</span> <span class="n">unknown_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># assign unknown cells (need category of same name)</span>
    <span class="n">df_sim_top</span><span class="p">[</span><span class="n">unknown_cells</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>

    <span class="c1"># add predicted category name to top list</span>
    <span class="c1"># top_list = df_sim_top.values</span>
    <span class="n">df_sim</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">df_meta</span><span class="p">[</span><span class="n">predict</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sim_top</span>

    <span class="k">return</span> <span class="n">df_sim</span><span class="p">,</span> <span class="n">df_meta</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.random_sample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">random_sample</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Return random sample of matrix.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">random_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Return random sample of matrix.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_to_df</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;row&#39;</span><span class="p">:</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>  <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.reset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>This re-initializes the Network object.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  This re-initializes the Network object.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">initialize_net</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.set_manual_category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_manual_category</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preferred_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>This method is used to tell Clustergrammer2 that the user wants to define
a manual category interactively using the dendrogram.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_manual_category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preferred_cats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  This method is used to tell Clustergrammer2 that the user wants to define</span>
<span class="sd">  a manual category interactively using the dendrogram.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="s1">&#39;col&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="s1">&#39;row&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>

  <span class="k">if</span> <span class="n">preferred_cats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">pref_cats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inst_row</span> <span class="ow">in</span> <span class="n">preferred_cats</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
        <span class="n">inst_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">inst_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_row</span>
        <span class="n">inst_dict</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preferred_cats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_row</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">pref_cats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst_dict</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="s1">&#39;col_cats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pref_cats</span>

    <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="s1">&#39;row_cats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pref_cats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.sim_same_and_diff_category_samples" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sim_same_and_diff_category_samples</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cat_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_roc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precalc_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calc_roc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Calculate the similarity of samples from the same and different categories. The
cat_index gives the index of the category, where 1 in the first category</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sim_same_and_diff_category_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">cat_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist_type</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
                                       <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_roc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">precalc_dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calc_roc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculate the similarity of samples from the same and different categories. The</span>
<span class="sd">    cat_index gives the index of the category, where 1 in the first category</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">precalc_dist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># compute distnace between rows (transpose to get cols as rows)</span>
        <span class="n">dist_arr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pdist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">metric</span><span class="o">=</span><span class="n">dist_type</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dist_arr</span> <span class="o">=</span> <span class="n">precalc_dist</span>

    <span class="c1"># generate sample names with categories</span>
    <span class="n">sample_combos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">sample_names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_same&#39;</span> <span class="k">if</span> <span class="n">cols</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">cat_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">cols</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">cat_index</span><span class="p">]</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_different&#39;</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sample_combos</span><span class="p">)]</span>

    <span class="n">ser_dist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dist_arr</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">sample_names</span><span class="p">)</span>

    <span class="c1"># find same-cat sample comparisons</span>
    <span class="n">same_cat</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sample_names</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;same&#39;</span><span class="p">]</span>

    <span class="c1"># find diff-cat sample comparisons</span>
    <span class="n">diff_cat</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sample_names</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;different&#39;</span><span class="p">]</span>

    <span class="c1"># make series of same and diff category sample comparisons</span>
    <span class="n">ser_same</span> <span class="o">=</span> <span class="n">ser_dist</span><span class="p">[</span><span class="n">same_cat</span><span class="p">]</span>
    <span class="n">ser_same</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Same Category&#39;</span>
    <span class="n">ser_diff</span> <span class="o">=</span> <span class="n">ser_dist</span><span class="p">[</span><span class="n">diff_cat</span><span class="p">]</span>
    <span class="n">ser_diff</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Different Category&#39;</span>

    <span class="n">sim_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">roc_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sim_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;same&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_same</span>
    <span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_diff</span>

    <span class="n">pval_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ttest_stat</span><span class="p">,</span> <span class="n">pval_dict</span><span class="p">[</span><span class="s1">&#39;ttest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">ser_diff</span><span class="p">,</span> <span class="n">ser_same</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="n">equal_var</span><span class="p">)</span>

    <span class="n">ttest_stat</span><span class="p">,</span> <span class="n">pval_dict</span><span class="p">[</span><span class="s1">&#39;mannwhitney&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">ser_diff</span><span class="p">,</span> <span class="n">ser_same</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">calc_roc</span><span class="p">:</span>
        <span class="c1"># calc AUC</span>
        <span class="n">true_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;same&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">false_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">y_true</span> <span class="o">=</span> <span class="n">true_index</span> <span class="o">+</span> <span class="n">false_index</span>

        <span class="n">true_val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;same&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">false_val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sim_dict</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">y_score</span> <span class="o">=</span> <span class="n">true_val</span> <span class="o">+</span> <span class="n">false_val</span>

        <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span><span class="p">)</span>

        <span class="n">inst_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_roc</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AUC&#39;</span><span class="p">,</span> <span class="n">inst_auc</span><span class="p">)</span>

        <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_true</span>
        <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_score</span>
        <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;fpr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpr</span>
        <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;tpr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tpr</span>
        <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresholds</span>
        <span class="n">roc_data</span><span class="p">[</span><span class="s1">&#39;auc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_auc</span>

    <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;sim_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_dict</span>
    <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;pval_dict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pval_dict</span>
    <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;roc_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_data</span>

    <span class="k">return</span> <span class="n">sim_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.swap_nan_for_zero" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">swap_nan_for_zero</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Swaps all NaN (numpy NaN) instances for zero.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">swap_nan_for_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Swaps all NaN (numpy NaN) instances for zero.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.widget" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">widget</span><span class="p">(</span><span class="n">which_viz</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">,</span> <span class="n">link_net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">link_net_js</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clust_library</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Generate a widget visualization using the widget. The export_viz_to_widget
method passes the visualization JSON to the instantiated widget, which is
returned and visualized on the front-end.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which_viz</span><span class="o">=</span><span class="s1">&#39;viz&#39;</span><span class="p">,</span> <span class="n">link_net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">link_net_js</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clust_library</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">,</span>
  <span class="n">min_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Generate a widget visualization using the widget. The export_viz_to_widget</span>
<span class="sd">  method passes the visualization JSON to the instantiated widget, which is</span>
<span class="sd">  returned and visualized on the front-end.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="c1"># run clustering if necessary</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;row_nodes&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">clust_library</span><span class="o">=</span><span class="n">clust_library</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span>
                 <span class="n">min_cluster_size</span><span class="o">=</span><span class="n">min_cluster_size</span><span class="p">)</span>

    <span class="c1"># add manual_category to viz json</span>
    <span class="k">if</span> <span class="s1">&#39;manual_category&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">]</span>

    <span class="c1"># add pre-z-score data to viz</span>
    <span class="k">if</span> <span class="s1">&#39;pre_zscore&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;pre_zscore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;pre_zscore&#39;</span><span class="p">]</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_class</span><span class="p">(</span><span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_viz_to_widget</span><span class="p">(</span><span class="n">which_viz</span><span class="p">))</span>

  <span class="c1"># initialize manual category</span>
  <span class="k">if</span> <span class="s1">&#39;manual_category&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">:</span>
    <span class="n">manual_cat</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;col&#39;</span>
    <span class="n">manual_cat</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">manual_cat</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;col_cat_colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viz</span><span class="p">[</span><span class="s1">&#39;cat_colors&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;cat-0&#39;</span><span class="p">]</span>

    <span class="n">man_cat_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;manual_category&#39;</span><span class="p">][</span><span class="n">axis</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span>
      <span class="n">manual_cat</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="n">man_cat_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_col</span><span class="p">[</span><span class="n">man_cat_name</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">manual_cat</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">manual_cat</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_manual_category</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;manual_cat&#39;</span><span class="p">)</span>

  <span class="c1"># add link (python)</span>
  <span class="k">if</span> <span class="n">link_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">inst_link</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">link</span><span class="p">(</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="p">,</span> <span class="s1">&#39;manual_cat&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">link_net</span><span class="o">.</span><span class="n">widget_instance</span><span class="p">,</span> <span class="s1">&#39;manual_cat&#39;</span><span class="p">)</span>
                             <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">inst_link</span>

  <span class="c1"># add jslink (JavaScript)</span>
  <span class="k">if</span> <span class="n">link_net_js</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

    <span class="n">inst_link</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">jslink</span><span class="p">(</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="p">,</span> <span class="s1">&#39;manual_cat&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">link_net_js</span><span class="o">.</span><span class="n">widget_instance</span><span class="p">,</span> <span class="s1">&#39;manual_cat&#39;</span><span class="p">)</span>
                             <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">inst_link</span>

  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.widget_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">widget_df</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Export a DataFrame from the front-end visualization. For instance, a user
can filter to show only a single cluster using the dendrogram and then
get a dataframe of this cluster using the widget_df method.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">widget_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Export a DataFrame from the front-end visualization. For instance, a user</span>
<span class="sd">  can filter to show only a single cluster using the dendrogram and then</span>
<span class="sd">  get a dataframe of this cluster using the widget_df method.</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;widget_instance&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">mat_string</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>

      <span class="n">tmp_net</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">Network</span><span class="p">())</span>

      <span class="n">df_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_instance</span><span class="o">.</span><span class="n">mat_string</span>

      <span class="n">tmp_net</span><span class="o">.</span><span class="n">load_file_as_string</span><span class="p">(</span><span class="n">df_string</span><span class="p">)</span>

      <span class="n">df</span> <span class="o">=</span> <span class="n">tmp_net</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>

      <span class="k">return</span> <span class="n">df</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_df</span><span class="p">()</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;widget_class&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please make the widget before exporting the widget DataFrame.&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Do this using the widget method: net.widget()&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Can not make widget because Network has no attribute widget_class&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please instantiate Network with clustergrammer_widget using: Network(clustergrammer_widget)&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.write_json_to_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_json_to_file</span><span class="p">(</span><span class="n">net_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;no-indent&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Save dat or viz as a JSON to file.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_json_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;no-indent&#39;</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Save dat or viz as a JSON to file.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">export_data</span><span class="o">.</span><span class="n">write_json_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="celldega.clust.Network.write_matrix_to_tsv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_matrix_to_tsv</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Export data-matrix to file.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_matrix_to_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Export data-matrix to file.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">return</span> <span class="n">export_data</span><span class="o">.</span><span class="n">write_matrix_to_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="celldega.clust.hc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">hc</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">filter_N_top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm_col</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">norm_row</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>This function performs hierarchical clustering on the rows and columns of a
DataFrame and returns the visualization JSON for the Celldega-Matrix method.
This function is developed using the approaches and code adaptations from the
Clustergrammer2 project.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Pandas DataFrame.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>filter_N_top</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of top dimensions to keep after filtering.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>norm_col</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of normalization to apply to the columns.</p>
              </div>
            </td>
            <td>
                  <code>&#39;total&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>norm_row</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of normalization to apply to the rows.</p>
              </div>
            </td>
            <td>
                  <code>&#39;zscore&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The visualization JSON for the Celldega-Matrix method</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Example:
See <a href="../../../examples/brief_notebooks/Landscape-Matrix_Xenium">Landscape-Matrix_Xenium</a> notebook.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/clust/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">hc</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">filter_N_top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm_col</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">norm_row</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">):</span>

<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  This function performs hierarchical clustering on the rows and columns of a</span>
<span class="sd">  DataFrame and returns the visualization JSON for the Celldega-Matrix method.</span>
<span class="sd">  This function is developed using the approaches and code adaptations from the</span>
<span class="sd">  Clustergrammer2 project.</span>

<span class="sd">  Args:</span>
<span class="sd">    df (pd.DataFrame): A Pandas DataFrame.</span>
<span class="sd">    filter_N_top (int): The number of top dimensions to keep after filtering.</span>
<span class="sd">    norm_col (str): The type of normalization to apply to the columns.</span>
<span class="sd">    norm_row (str): The type of normalization to apply to the rows.</span>

<span class="sd">  Returns:</span>
<span class="sd">    dict: The visualization JSON for the Celldega-Matrix method</span>


<span class="sd">  Example:</span>
<span class="sd">  See [Landscape-Matrix_Xenium](../../../examples/brief_notebooks/Landscape-Matrix_Xenium) notebook.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="n">net</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>

  <span class="n">net</span><span class="o">.</span><span class="n">load_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">filter_N_top</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">net</span><span class="o">.</span><span class="n">filter_N_top</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">N_top</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">norm_col</span> <span class="o">==</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span>
    <span class="n">net</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">norm_type</span><span class="o">=</span><span class="s1">&#39;umi&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">norm_row</span> <span class="o">==</span> <span class="s1">&#39;zscore&#39;</span><span class="p">:</span>
    <span class="n">net</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">norm_type</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">)</span>

  <span class="n">net</span><span class="o">.</span><span class="n">cluster</span><span class="p">()</span>

  <span class="n">network</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">viz</span>

  <span class="k">return</span> <span class="n">network</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/broadinstitute/celldega" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://bsky.app/profile/stp-broad.bsky.social" target="_blank" rel="noopener" title="bsky.app" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3 3.4.4 6.7.9 10 1.3zM288 227.1c-26.1-50.7-97.1-145.2-163.1-191.8C61.6-9.4 37.5-1.7 21.6 5.5 3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7 3.3-.5 6.6-.9 10-1.4-3.3.5-6.6 1-10 1.4-93.9 14-177.3 48.2-67.9 169.9C220.6 589.1 265.1 437.8 288 361.1c22.9 76.7 49.2 222.5 185.6 103.4 102.4-103.4 28.1-156-65.8-169.9-3.3-.4-6.7-.8-10-1.3 3.4.4 6.7.9 10 1.3 64.1 7.1 133.6-15.1 153.2-80.7C566.9 194 576 75 576 58.4s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8C385.1 81.9 314.1 176.4 288 227.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../assets/js/index.js" type="module"></script>
      
        <script src="../../../assets/js/gallery_mouse_brain.js" type="module"></script>
      
        <script src="../../../assets/js/gallery_skin_cancer.js" type="module"></script>
      
        <script src="../../../assets/js/google-analytics.js"></script>
      
        <script src="../../../assets/js/hide_notebook_sidebar.js" type="module"></script>
      
        <script src="../../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>