
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>Python API Reference - Celldega Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#python-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Celldega Documentation" class="md-header__button md-logo" aria-label="Celldega Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Celldega Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Celldega Documentation" class="md-nav__button md-logo" aria-label="Celldega Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Celldega Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../overview/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Overview
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/file_formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Formats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Python API
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Python API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pre/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pre
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../viz/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    viz
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../javascript/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    JavaScript API
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            JavaScript API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../technologies/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Technologies
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Technologies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../gallery/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Gallery
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Gallery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Xenium
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Xenium
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/gallery_xenium_mouse_brain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xenium Prime Mouse Brain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/gallery_xenium_skin_cancer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xenium Prime Human Skin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/gallery_xenium_multi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xenium Multi Dataset
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../examples/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Example Notebooks
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Example Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Brief Notebooks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Brief Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/brief_notebooks/Landscape_View_Xenium/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Landscape View Xenium
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/brief_notebooks/Pre-process_Xenium_V1_human_Pancreas_FFPE_outs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pre-process_Xenium_V1_human_Pancreas_FFPE_outs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#celldega.nbhd" class="md-nav__link">
    <span class="md-ellipsis">
      nbhd
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.nbhd.alpha_shape_cell_clusters" class="md-nav__link">
    <span class="md-ellipsis">
      alpha_shape_cell_clusters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre" class="md-nav__link">
    <span class="md-ellipsis">
      pre
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.calc_meta_gene_data" class="md-nav__link">
    <span class="md-ellipsis">
      calc_meta_gene_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.convert_long_id_to_short" class="md-nav__link">
    <span class="md-ellipsis">
      convert_long_id_to_short
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_jpeg" class="md-nav__link">
    <span class="md-ellipsis">
      convert_to_jpeg
    </span>
  </a>
  
    <nav class="md-nav" aria-label="convert_to_jpeg">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_jpeg--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_jpeg--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_png" class="md-nav__link">
    <span class="md-ellipsis">
      convert_to_png
    </span>
  </a>
  
    <nav class="md-nav" aria-label="convert_to_png">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_png--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_png--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_webp" class="md-nav__link">
    <span class="md-ellipsis">
      convert_to_webp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="convert_to_webp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_webp--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.convert_to_webp--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.get_max_zoom_level" class="md-nav__link">
    <span class="md-ellipsis">
      get_max_zoom_level
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.make_cell_boundary_tiles" class="md-nav__link">
    <span class="md-ellipsis">
      make_cell_boundary_tiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="make_cell_boundary_tiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_cell_boundary_tiles--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_cell_boundary_tiles--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.make_deepzoom_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      make_deepzoom_pyramid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="make_deepzoom_pyramid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_deepzoom_pyramid--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_deepzoom_pyramid--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.make_meta_cell_image_coord" class="md-nav__link">
    <span class="md-ellipsis">
      make_meta_cell_image_coord
    </span>
  </a>
  
    <nav class="md-nav" aria-label="make_meta_cell_image_coord">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_meta_cell_image_coord--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_meta_cell_image_coord--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_meta_cell_image_coord--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.make_meta_gene" class="md-nav__link">
    <span class="md-ellipsis">
      make_meta_gene
    </span>
  </a>
  
    <nav class="md-nav" aria-label="make_meta_gene">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_meta_gene--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_meta_gene--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_meta_gene--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.make_trx_tiles" class="md-nav__link">
    <span class="md-ellipsis">
      make_trx_tiles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="make_trx_tiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_trx_tiles--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.make_trx_tiles--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.read_cbg_mtx" class="md-nav__link">
    <span class="md-ellipsis">
      read_cbg_mtx
    </span>
  </a>
  
    <nav class="md-nav" aria-label="read_cbg_mtx">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.read_cbg_mtx--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.read_cbg_mtx--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.reduce_image_size" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_image_size
    </span>
  </a>
  
    <nav class="md-nav" aria-label="reduce_image_size">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.reduce_image_size--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.reduce_image_size--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.save_cbg_gene_parquets" class="md-nav__link">
    <span class="md-ellipsis">
      save_cbg_gene_parquets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="save_cbg_gene_parquets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#celldega.pre.save_cbg_gene_parquets--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#celldega.pre.save_cbg_gene_parquets--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.pre.save_landscape_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      save_landscape_parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.viz" class="md-nav__link">
    <span class="md-ellipsis">
      viz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.viz.Landscape" class="md-nav__link">
    <span class="md-ellipsis">
      Landscape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#celldega.viz.Matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Matrix
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="python-api-reference">Python API Reference</h1>


<div class="doc doc-object doc-module">



<a id="celldega.nbhd"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="celldega.nbhd.alpha_shape_cell_clusters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">alpha_shape_cell_clusters</span><span class="p">(</span><span class="n">meta_cell</span><span class="p">,</span> <span class="n">cat</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">alphas</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">350</span><span class="p">])</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Compute alpha shapes for each cluster in the cell metadata.</p>
<p>Parameters:
- meta_cell: GeoDataFrame of cell metadata.
- cat: Column name in meta_cell containing the cluster labels.
- alphas: List of alpha values to compute shapes for.</p>
<p>Returns:
- GeoDataFrame of alpha shapes.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/nbhd/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">alpha_shape_cell_clusters</span><span class="p">(</span><span class="n">meta_cell</span><span class="p">,</span> <span class="n">cat</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">alphas</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">350</span><span class="p">]):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute alpha shapes for each cluster in the cell metadata.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - meta_cell: GeoDataFrame of cell metadata.</span>
<span class="sd">    - cat: Column name in meta_cell containing the cluster labels.</span>
<span class="sd">    - alphas: List of alpha values to compute shapes for.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - GeoDataFrame of alpha shapes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gdf_alpha</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">inv_alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">inst_cluster</span> <span class="ow">in</span> <span class="n">meta_cell</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>

            <span class="n">inst_clust</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="p">[</span><span class="n">meta_cell</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">==</span> <span class="n">inst_cluster</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">inst_clust</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>

                <span class="n">nested_array</span> <span class="o">=</span> <span class="n">inst_clust</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

                <span class="c1"># Convert to a 2D NumPy array</span>
                <span class="n">flat_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">nested_array</span><span class="p">)</span>

                <span class="n">inst_shape</span> <span class="o">=</span> <span class="n">alpha_shape</span><span class="p">(</span><span class="n">flat_array</span><span class="p">,</span> <span class="n">inv_alpha</span><span class="p">)</span>

                <span class="n">inst_name</span> <span class="o">=</span> <span class="n">inst_cluster</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inv_alpha</span><span class="p">)</span>

                <span class="n">gdf_alpha</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_name</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_name</span>

                <span class="n">gdf_alpha</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_name</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_cluster</span>

                <span class="n">gdf_alpha</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_name</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst_shape</span>

                <span class="n">gdf_alpha</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inst_name</span><span class="p">,</span> <span class="s1">&#39;inv_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">inv_alpha</span><span class="p">)</span>

    <span class="n">gdf_alpha</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_alpha</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">geom</span><span class="p">:</span> <span class="n">_round_coordinates</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">gdf_alpha</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_alpha</span><span class="o">.</span><span class="n">area</span>

    <span class="n">gdf_alpha</span> <span class="o">=</span> <span class="n">gdf_alpha</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gdf_alpha</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">gdf_alpha</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="celldega.pre"></a>
    <div class="doc doc-contents first">

      <p>Module for pre-processing to generate LandscapeFiles from ST data.</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="celldega.pre.calc_meta_gene_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calc_meta_gene_data</span><span class="p">(</span><span class="n">cbg</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate gene metadata from the cell-by-gene matrix</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>cbg</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A sparse DataFrame with genes as columns and barcodes as rows.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pandas.DataFrame: A DataFrame with gene metadata including mean, standard deviation,
maximum expression, and proportion of non-zero expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/landscape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calc_meta_gene_data</span><span class="p">(</span><span class="n">cbg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate gene metadata from the cell-by-gene matrix</span>

<span class="sd">    Args:</span>
<span class="sd">        cbg (pandas.DataFrame): A sparse DataFrame with genes as columns and barcodes as rows.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: A DataFrame with gene metadata including mean, standard deviation,</span>
<span class="sd">            maximum expression, and proportion of non-zero expression.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Helper function to convert to dense if sparse</span>
    <span class="k">def</span> <span class="nf">convert_to_dense</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a pandas Series to dense format if it&#39;s sparse.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        series : pandas.Series</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.Series</span>
<span class="sd">            Dense Series if input was sparse; original Series otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">to_dense</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">series</span>

    <span class="c1"># Ensure cbg is a DataFrame</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cbg</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cbg must be a pandas DataFrame&quot;</span><span class="p">)</span>

    <span class="c1"># Determine if cbg is sparse</span>
    <span class="n">is_sparse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">(</span><span class="n">cbg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_sparse</span><span class="p">:</span>
        <span class="c1"># Ensure cbg has SparseDtype with float and fill_value=0</span>
        <span class="n">cbg</span> <span class="o">=</span> <span class="n">cbg</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">SparseDtype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cbg is a sparse DataFrame. Proceeding with sparse operations.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cbg is a dense DataFrame. Proceeding with dense operations.&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate mean expression across tiles</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating mean expression&quot;</span><span class="p">)</span>
    <span class="n">mean_expression</span> <span class="o">=</span> <span class="n">cbg</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate variance as the average of the squared deviations</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating variance&quot;</span><span class="p">)</span>
    <span class="n">num_tiles</span> <span class="o">=</span> <span class="n">cbg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">variance</span> <span class="o">=</span> <span class="n">cbg</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean_expression</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">num_tiles</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">std_deviation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span>

    <span class="c1"># Calculate maximum expression</span>
    <span class="n">max_expression</span> <span class="o">=</span> <span class="n">cbg</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate proportion of tiles with non-zero expression</span>
    <span class="n">proportion_nonzero</span> <span class="o">=</span> <span class="p">(</span><span class="n">cbg</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">cbg</span><span class="p">)</span>

    <span class="c1"># Create a DataFrame to hold all these metrics</span>
    <span class="n">meta_gene</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mean_expression</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">to_dense</span><span class="p">(),</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std_deviation</span><span class="p">,</span>
            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">max_expression</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">to_dense</span><span class="p">(),</span>
            <span class="s2">&quot;non-zero&quot;</span><span class="p">:</span> <span class="n">proportion_nonzero</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">to_dense</span><span class="p">(),</span>
        <span class="p">}</span>

    <span class="p">)</span>

    <span class="n">meta_gene_clean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">meta_gene</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">meta_gene</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">meta_gene</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">meta_gene_clean</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.convert_long_id_to_short" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_long_id_to_short</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Converts a column of long integer cell IDs in a DataFrame to a shorter, hash-based representation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>df</code></td>
            <td>
                  <code><span title="celldega.pre.boundary_tile.pd.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DataFrame containing the EntityID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns:
    pd.DataFrame: The original DataFrame with an additional column named <code>cell_id</code>
                  containing the shortened cell IDs.</p>
<p>The function applies a SHA-256 hash to each cell ID, encodes the hash using base64, and truncates
it to create a shorter identifier that is added as a new column to the DataFrame.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_long_id_to_short</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a column of long integer cell IDs in a DataFrame to a shorter, hash-based representation.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): The DataFrame containing the EntityID.</span>
<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The original DataFrame with an additional column named `cell_id`</span>
<span class="sd">                      containing the shortened cell IDs.</span>

<span class="sd">    The function applies a SHA-256 hash to each cell ID, encodes the hash using base64, and truncates</span>
<span class="sd">    it to create a shorter identifier that is added as a new column to the DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Function to hash and encode the cell ID</span>
    <span class="k">def</span> <span class="nf">hash_and_shorten_id</span><span class="p">(</span><span class="n">cell_id</span><span class="p">):</span>
        <span class="c1"># Create a hash of the cell ID</span>
        <span class="n">cell_id_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">hash_object</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">cell_id_bytes</span><span class="p">)</span>
        <span class="n">hash_digest</span> <span class="o">=</span> <span class="n">hash_object</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

        <span class="c1"># Encode the hash to a base64 string to mix letters and numbers, truncate to 9 characters</span>
        <span class="n">short_id</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">hash_digest</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)[:</span><span class="mi">9</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">short_id</span>

    <span class="c1"># Apply the hash_and_shorten_id function to each cell ID in the specified column</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cell_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;EntityID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">hash_and_shorten_id</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.convert_to_jpeg" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_to_jpeg</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Convert a TIFF image to a JPEG image with a quality of score</p>
<h4 id="celldega.pre.convert_to_jpeg--parameters">Parameters</h4>
<p>image_path : str
    Path to the image file
quality : int (default=80)
    Quality score for the JPEG image</p>
<h4 id="celldega.pre.convert_to_jpeg--returns">Returns</h4>
<p>new_image_path : str
    Path to the JPEG image file</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_to_jpeg</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a TIFF image to a JPEG image with a quality of score</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image_path : str</span>
<span class="sd">        Path to the image file</span>
<span class="sd">    quality : int (default=80)</span>
<span class="sd">        Quality score for the JPEG image</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_image_path : str</span>
<span class="sd">        Path to the JPEG image file</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load the TIFF image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">pyvips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_file</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s2">&quot;sequential&quot;</span><span class="p">)</span>

    <span class="c1"># Save the image as a JPEG with a quality of 80</span>
    <span class="n">new_image_path</span> <span class="o">=</span> <span class="n">image_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">)</span>
    <span class="n">image</span><span class="o">.</span><span class="n">jpegsave</span><span class="p">(</span><span class="n">new_image_path</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_image_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.convert_to_png" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_to_png</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Convert a TIFF image to a JPEG image with a quality of score</p>
<h4 id="celldega.pre.convert_to_png--parameters">Parameters</h4>
<p>image_path : str
    Path to the image file
quality : int (default=80)
    Quality score for the JPEG image</p>
<h4 id="celldega.pre.convert_to_png--returns">Returns</h4>
<p>new_image_path : str
    Path to the JPEG image file</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_to_png</span><span class="p">(</span><span class="n">image_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a TIFF image to a JPEG image with a quality of score</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image_path : str</span>
<span class="sd">        Path to the image file</span>
<span class="sd">    quality : int (default=80)</span>
<span class="sd">        Quality score for the JPEG image</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_image_path : str</span>
<span class="sd">        Path to the JPEG image file</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load the TIFF image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">pyvips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_file</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s2">&quot;sequential&quot;</span><span class="p">)</span>

    <span class="c1"># Save the image as a JPEG with a quality of 80</span>
    <span class="n">new_image_path</span> <span class="o">=</span> <span class="n">image_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>
    <span class="n">image</span><span class="o">.</span><span class="n">pngsave</span><span class="p">(</span><span class="n">new_image_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_image_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.convert_to_webp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_to_webp</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Convert a TIFF image to a WEBP image with a specified quality score.</p>
<h4 id="celldega.pre.convert_to_webp--parameters">Parameters</h4>
<p>image_path : str
    Path to the image file
quality : int (default=100)
    Quality score for the WEBP image (higher is better quality)</p>
<h4 id="celldega.pre.convert_to_webp--returns">Returns</h4>
<p>new_image_path : str
    Path to the WEBP image file</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_to_webp</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a TIFF image to a WEBP image with a specified quality score.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image_path : str</span>
<span class="sd">        Path to the image file</span>
<span class="sd">    quality : int (default=100)</span>
<span class="sd">        Quality score for the WEBP image (higher is better quality)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_image_path : str</span>
<span class="sd">        Path to the WEBP image file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Load the TIFF image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">pyvips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_file</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s2">&quot;sequential&quot;</span><span class="p">)</span>

    <span class="c1"># Save the image as a WEBP with specified quality</span>
    <span class="n">new_image_path</span> <span class="o">=</span> <span class="n">image_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.webp&quot;</span><span class="p">)</span>
    <span class="n">image</span><span class="o">.</span><span class="n">webpsave</span><span class="p">(</span><span class="n">new_image_path</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="n">quality</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_image_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.get_max_zoom_level" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_max_zoom_level</span><span class="p">(</span><span class="n">path_image_pyramid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Returns the maximum zoom level based on the highest-numbered directory
in the specified path_image_pyramid.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>path_image_pyramid</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the directory containing zoom level directories.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>max_pyramid_zoom</code></td>            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum zoom level.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_max_zoom_level</span><span class="p">(</span><span class="n">path_image_pyramid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the maximum zoom level based on the highest-numbered directory</span>
<span class="sd">    in the specified path_image_pyramid.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        path_image_pyramid (str): The path to the directory containing zoom level directories.</span>

<span class="sd">    Returns:</span>
<span class="sd">        max_pyramid_zoom (int): The maximum zoom level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># List all entries in the path_image_pyramid that are directories and can be converted to integers</span>
    <span class="n">zoom_levels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">entry</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_image_pyramid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_image_pyramid</span><span class="p">,</span> <span class="n">entry</span><span class="p">))</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="c1"># Convert to integer and find the maximum value</span>
    <span class="n">max_pyramid_zoom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">zoom_levels</span><span class="p">))</span> <span class="k">if</span> <span class="n">zoom_levels</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">max_pyramid_zoom</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.make_cell_boundary_tiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_cell_boundary_tiles</span><span class="p">(</span><span class="n">technology</span><span class="p">,</span> <span class="n">path_cell_boundaries</span><span class="p">,</span> <span class="n">path_meta_cell_micron</span><span class="p">,</span> <span class="n">path_transformation_matrix</span><span class="p">,</span> <span class="n">path_output</span><span class="p">,</span> <span class="n">coarse_tile_factor</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">tile_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Processes cell boundary data and divides it into spatial tiles based on the provided technology.
Reads cell boundary data, applies affine transformations, and divides the data into coarse and fine tiles.
The resulting tiles are saved as Parquet files, each containing the geometries of cells in that tile.</p>
<h4 id="celldega.pre.make_cell_boundary_tiles--parameters">Parameters</h4>
<p>technology : str
    The technology used to generate the cell boundary data, e.g., "MERSCOPE", "Xenium", or "custom".
path_cell_boundaries : str
    Path to the file containing the cell boundaries (Parquet format).
path_meta_cell_micron : str
    Path to the file containing cell metadata (CSV format).
path_transformation_matrix : str
    Path to the file containing the transformation matrix (CSV format).
path_output : str
    Directory path where the output files (Parquet files) for each tile will be saved.
coarse_tile_factor  : int, optional, default=20.
    scaling factor of each coarse-grain tile comparing to the fine tile size.
tile_size : int, optional, default=500
    Size of each fine-grain tile in microns.
tile_bounds : dict, optional
    Dictionary containing the minimum and maximum bounds for x and y coordinates.
image_scale : float, optional, default=1
    Scale factor to apply to the geometry data.
max_workers : int, optional, default=8
    Maximum number of parallel workers for processing tiles.</p>
<h4 id="celldega.pre.make_cell_boundary_tiles--returns">Returns</h4>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/boundary_tile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_cell_boundary_tiles</span><span class="p">(</span>
    <span class="n">technology</span><span class="p">,</span>
    <span class="n">path_cell_boundaries</span><span class="p">,</span>
    <span class="n">path_meta_cell_micron</span><span class="p">,</span>
    <span class="n">path_transformation_matrix</span><span class="p">,</span>
    <span class="n">path_output</span><span class="p">,</span>
    <span class="n">coarse_tile_factor</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">tile_size</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
    <span class="n">tile_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">image_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span>
<span class="p">):</span>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes cell boundary data and divides it into spatial tiles based on the provided technology.</span>
<span class="sd">    Reads cell boundary data, applies affine transformations, and divides the data into coarse and fine tiles.</span>
<span class="sd">    The resulting tiles are saved as Parquet files, each containing the geometries of cells in that tile.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    technology : str</span>
<span class="sd">        The technology used to generate the cell boundary data, e.g., &quot;MERSCOPE&quot;, &quot;Xenium&quot;, or &quot;custom&quot;.</span>
<span class="sd">    path_cell_boundaries : str</span>
<span class="sd">        Path to the file containing the cell boundaries (Parquet format).</span>
<span class="sd">    path_meta_cell_micron : str</span>
<span class="sd">        Path to the file containing cell metadata (CSV format).</span>
<span class="sd">    path_transformation_matrix : str</span>
<span class="sd">        Path to the file containing the transformation matrix (CSV format).</span>
<span class="sd">    path_output : str</span>
<span class="sd">        Directory path where the output files (Parquet files) for each tile will be saved.</span>
<span class="sd">    coarse_tile_factor  : int, optional, default=20.</span>
<span class="sd">        scaling factor of each coarse-grain tile comparing to the fine tile size.</span>
<span class="sd">    tile_size : int, optional, default=500</span>
<span class="sd">        Size of each fine-grain tile in microns.</span>
<span class="sd">    tile_bounds : dict, optional</span>
<span class="sd">        Dictionary containing the minimum and maximum bounds for x and y coordinates.</span>
<span class="sd">    image_scale : float, optional, default=1</span>
<span class="sd">        Scale factor to apply to the geometry data.</span>
<span class="sd">    max_workers : int, optional, default=8</span>
<span class="sd">        Maximum number of parallel workers for processing tiles.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">numpy_affine_transform</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply affine transformation to numpy coordinates.&quot;&quot;&quot;</span>
        <span class="c1"># Homogeneous coordinates for affine transformation</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))])</span>
        <span class="n">transformed_coords</span> <span class="o">=</span> <span class="n">coords</span> <span class="o">@</span> <span class="n">matrix</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">transformed_coords</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Drop the homogeneous coordinate</span>

    <span class="k">def</span> <span class="nf">batch_transform_geometries</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">transformation_matrix</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Batch transform geometries using numpy for optimized performance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Extract affine transformation parameters into a 3x3 matrix for numpy</span>
        <span class="n">affine_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">transformation_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">transformation_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">transformation_matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">transformation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">transformation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">transformation_matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span>

        <span class="n">transformed_geometries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">:</span>
            <span class="c1"># Extract coordinates and transform them</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
                <span class="n">polygon</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>  <span class="c1"># Use the first geometry</span>

            <span class="c1"># Transform the exterior of the polygon</span>
            <span class="n">exterior_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

            <span class="c1"># Apply the affine transformation and scale</span>
            <span class="n">transformed_coords</span> <span class="o">=</span> <span class="n">numpy_affine_transform</span><span class="p">(</span><span class="n">exterior_coords</span><span class="p">,</span> <span class="n">affine_matrix</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>

            <span class="c1"># Append the result to the transformed_geometries list</span>
            <span class="n">transformed_geometries</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">transformed_coords</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>

        <span class="k">return</span> <span class="n">transformed_geometries</span>


    <span class="k">def</span> <span class="nf">filter_and_save_fine_boundary</span><span class="p">(</span><span class="n">coarse_tile</span><span class="p">,</span> <span class="n">fine_i</span><span class="p">,</span> <span class="n">fine_j</span><span class="p">,</span> <span class="n">fine_tile_x_min</span><span class="p">,</span> <span class="n">fine_tile_x_max</span><span class="p">,</span> <span class="n">fine_tile_y_min</span><span class="p">,</span> <span class="n">fine_tile_y_max</span><span class="p">,</span> <span class="n">path_output</span><span class="p">):</span>
        <span class="n">cell_ids</span> <span class="o">=</span> <span class="n">coarse_tile</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

        <span class="n">tile_filter</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">coarse_tile</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">fine_tile_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">coarse_tile</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">fine_tile_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">coarse_tile</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">fine_tile_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">coarse_tile</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">fine_tile_y_max</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">filtered_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tile_filter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">keep_cells</span> <span class="o">=</span> <span class="n">cell_ids</span><span class="p">[</span><span class="n">filtered_indices</span><span class="p">]</span>
        <span class="n">fine_tile_cells</span> <span class="o">=</span> <span class="n">coarse_tile</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep_cells</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;GEOMETRY&quot;</span><span class="p">]]</span>
        <span class="n">fine_tile_cells</span> <span class="o">=</span> <span class="n">fine_tile_cells</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fine_tile_cells</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fine_tile_cells</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_output</span><span class="si">}</span><span class="s2">/cell_tile_</span><span class="si">{</span><span class="n">fine_i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fine_j</span><span class="si">}</span><span class="s2">.parquet&quot;</span>
            <span class="n">fine_tile_cells</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process_fine_boundaries</span><span class="p">(</span><span class="n">coarse_tile</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coarse_tile_x_min</span><span class="p">,</span> <span class="n">coarse_tile_x_max</span><span class="p">,</span> <span class="n">coarse_tile_y_min</span><span class="p">,</span> <span class="n">coarse_tile_y_max</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">,</span> <span class="n">path_output</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">n_fine_tiles_x</span><span class="p">,</span> <span class="n">n_fine_tiles_y</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">fine_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_fine_tiles_x</span><span class="p">):</span>
                <span class="n">fine_tile_x_min</span> <span class="o">=</span> <span class="n">x_min</span> <span class="o">+</span> <span class="n">fine_i</span> <span class="o">*</span> <span class="n">tile_size</span>
                <span class="n">fine_tile_x_max</span> <span class="o">=</span> <span class="n">fine_tile_x_min</span> <span class="o">+</span> <span class="n">tile_size</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fine_tile_x_min</span> <span class="o">&gt;=</span> <span class="n">coarse_tile_x_min</span> <span class="ow">and</span> <span class="n">fine_tile_x_max</span> <span class="o">&lt;=</span> <span class="n">coarse_tile_x_max</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">for</span> <span class="n">fine_j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_fine_tiles_y</span><span class="p">):</span>
                    <span class="n">fine_tile_y_min</span> <span class="o">=</span> <span class="n">y_min</span> <span class="o">+</span> <span class="n">fine_j</span> <span class="o">*</span> <span class="n">tile_size</span>
                    <span class="n">fine_tile_y_max</span> <span class="o">=</span> <span class="n">fine_tile_y_min</span> <span class="o">+</span> <span class="n">tile_size</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fine_tile_y_min</span> <span class="o">&gt;=</span> <span class="n">coarse_tile_y_min</span> <span class="ow">and</span> <span class="n">fine_tile_y_max</span> <span class="o">&lt;=</span> <span class="n">coarse_tile_y_max</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                        <span class="n">filter_and_save_fine_boundary</span><span class="p">,</span> <span class="n">coarse_tile</span><span class="p">,</span> <span class="n">fine_i</span><span class="p">,</span> <span class="n">fine_j</span><span class="p">,</span> <span class="n">fine_tile_x_min</span><span class="p">,</span> <span class="n">fine_tile_x_max</span><span class="p">,</span> <span class="n">fine_tile_y_min</span><span class="p">,</span> <span class="n">fine_tile_y_max</span><span class="p">,</span> <span class="n">path_output</span>
                    <span class="p">))</span>

            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
                <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

    <span class="n">tile_size_x</span> <span class="o">=</span> <span class="n">tile_size</span>
    <span class="n">tile_size_y</span> <span class="o">=</span> <span class="n">tile_size</span>

    <span class="n">transformation_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_transformation_matrix</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Load cell boundary data based on the technology</span>
    <span class="k">if</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;MERSCOPE&quot;</span><span class="p">:</span>
        <span class="n">df_meta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;cell_segmentation&#39;</span><span class="p">,</span><span class="s1">&#39;cell_metadata.parquet&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">entity_to_cell_id_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df_meta</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df_meta</span><span class="o">.</span><span class="n">EntityID</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">cells_orig</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_cell_boundaries</span><span class="p">)</span>
        <span class="n">cells_orig</span><span class="p">[</span><span class="s1">&#39;cell_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cells_orig</span><span class="p">[</span><span class="s1">&#39;EntityID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">entity_to_cell_id_dict</span><span class="p">)</span>
        <span class="n">cells_orig</span> <span class="o">=</span> <span class="n">cells_orig</span><span class="p">[</span><span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;ZIndex&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Correct cell_id issues with meta_cell</span>
        <span class="n">meta_cell</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_meta_cell_micron</span><span class="p">)</span>
        <span class="n">meta_cell</span><span class="p">[</span><span class="s1">&#39;cell_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="p">[</span><span class="s1">&#39;EntityID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">entity_to_cell_id_dict</span><span class="p">)</span>
        <span class="n">cells_orig</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="p">[</span><span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;cell_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cells_orig</span><span class="p">[</span><span class="s1">&#39;cell_id&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">index</span>

        <span class="c1"># Correct &#39;MultiPolygon&#39; to &#39;Polygon&#39;</span>
        <span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;Geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">geoms</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
        <span class="p">)</span>

        <span class="n">cells_orig</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;cell_id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;Xenium&quot;</span><span class="p">:</span>
        <span class="n">xenium_cells</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_cell_boundaries</span><span class="p">)</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="n">xenium_cells</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cell_id&quot;</span><span class="p">)[[</span><span class="s2">&quot;vertex_x&quot;</span><span class="p">,</span> <span class="s2">&quot;vertex_y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">grouped</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">Polygon</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;vertex_x&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;vertex_y&quot;</span><span class="p">])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cells_orig</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">grouped</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">)[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>

    <span class="k">elif</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
        <span class="n">cells_orig</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_cell_boundaries</span><span class="p">)</span>

    <span class="c1"># Transform geometries</span>
    <span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;GEOMETRY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch_transform_geometries</span><span class="p">(</span><span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span> <span class="n">transformation_matrix</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">)</span>

    <span class="c1"># Convert transformed geometries to polygons and calculate centroids</span>
    <span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;polygon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;GEOMETRY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">gdf_cells</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;polygon&quot;</span><span class="p">])</span>
    <span class="n">gdf_cells</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_cells</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span>
    <span class="n">gdf_cells</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_cells</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span>
    <span class="n">gdf_cells</span><span class="p">[</span><span class="s2">&quot;GEOMETRY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cells_orig</span><span class="p">[</span><span class="s2">&quot;GEOMETRY&quot;</span><span class="p">]</span>

    <span class="c1"># Ensure the output directory exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_output</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_output</span><span class="p">)</span>

    <span class="c1"># Calculate tile bounds and fine/coarse tiles</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">tile_bounds</span><span class="p">[</span><span class="s2">&quot;x_min&quot;</span><span class="p">],</span> <span class="n">tile_bounds</span><span class="p">[</span><span class="s2">&quot;x_max&quot;</span><span class="p">]</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">tile_bounds</span><span class="p">[</span><span class="s2">&quot;y_min&quot;</span><span class="p">],</span> <span class="n">tile_bounds</span><span class="p">[</span><span class="s2">&quot;y_max&quot;</span><span class="p">]</span>
    <span class="n">n_fine_tiles_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">tile_size</span><span class="p">))</span>
    <span class="n">n_fine_tiles_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">tile_size</span><span class="p">))</span>
    <span class="n">n_coarse_tiles_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)))</span>
    <span class="n">n_coarse_tiles_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)))</span>

    <span class="c1"># Process coarse tiles in parallel</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_coarse_tiles_x</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing coarse tiles&quot;</span><span class="p">):</span>
        <span class="n">coarse_tile_x_min</span> <span class="o">=</span> <span class="n">x_min</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>
        <span class="n">coarse_tile_x_max</span> <span class="o">=</span> <span class="n">coarse_tile_x_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_coarse_tiles_y</span><span class="p">):</span>
            <span class="n">coarse_tile_y_min</span> <span class="o">=</span> <span class="n">y_min</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>
            <span class="n">coarse_tile_y_max</span> <span class="o">=</span> <span class="n">coarse_tile_y_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>

            <span class="n">coarse_tile</span> <span class="o">=</span> <span class="n">gdf_cells</span><span class="p">[</span>
                <span class="p">(</span><span class="n">gdf_cells</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">coarse_tile_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gdf_cells</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">coarse_tile_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">gdf_cells</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">coarse_tile_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">gdf_cells</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">coarse_tile_y_max</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">coarse_tile</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">process_fine_boundaries</span><span class="p">(</span><span class="n">coarse_tile</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coarse_tile_x_min</span><span class="p">,</span> <span class="n">coarse_tile_x_max</span><span class="p">,</span> <span class="n">coarse_tile_y_min</span><span class="p">,</span> <span class="n">coarse_tile_y_max</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">,</span> <span class="n">path_output</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">n_fine_tiles_x</span><span class="p">,</span> <span class="n">n_fine_tiles_y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.make_deepzoom_pyramid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_deepzoom_pyramid</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">pyramid_name</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Create a DeepZoom image pyramid from a JPEG image</p>
<h4 id="celldega.pre.make_deepzoom_pyramid--parameters">Parameters</h4>
<p>image_path : str
    Path to the JPEG image file
tile_size : int (default=512)
    Tile size for the DeepZoom pyramid
overlap : int (default=0)
    Overlap size for the DeepZoom pyramid
suffix : str (default='jpeg')
    Suffix for the DeepZoom pyramid tiles</p>
<h4 id="celldega.pre.make_deepzoom_pyramid--returns">Returns</h4>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_deepzoom_pyramid</span><span class="p">(</span>
    <span class="n">image_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">pyramid_name</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.jpeg&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a DeepZoom image pyramid from a JPEG image</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image_path : str</span>
<span class="sd">        Path to the JPEG image file</span>
<span class="sd">    tile_size : int (default=512)</span>
<span class="sd">        Tile size for the DeepZoom pyramid</span>
<span class="sd">    overlap : int (default=0)</span>
<span class="sd">        Overlap size for the DeepZoom pyramid</span>
<span class="sd">    suffix : str (default=&#39;jpeg&#39;)</span>
<span class="sd">        Suffix for the DeepZoom pyramid tiles</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define the output path</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>

    <span class="c1"># Load the JPEG image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">pyvips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_file</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s2">&quot;sequential&quot;</span><span class="p">)</span>

    <span class="c1"># check if the output path exists and create it if it does not</span>
    <span class="n">output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># append the pyramid name to the output path</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">output_path</span> <span class="o">/</span> <span class="n">pyramid_name</span>

    <span class="c1"># Save the image as a DeepZoom image pyramid</span>
    <span class="n">image</span><span class="o">.</span><span class="n">dzsave</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="n">tile_size</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.make_meta_cell_image_coord" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_meta_cell_image_coord</span><span class="p">(</span><span class="n">technology</span><span class="p">,</span> <span class="n">path_transformation_matrix</span><span class="p">,</span> <span class="n">path_meta_cell_micron</span><span class="p">,</span> <span class="n">path_meta_cell_image</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Apply an affine transformation to the cell coordinates in microns and save
the transformed coordinates in pixels</p>
<h4 id="celldega.pre.make_meta_cell_image_coord--parameters">Parameters</h4>
<p>technology : str
    The technology used to generate the data, Xenium and MERSCOPE are supported.
path_transformation_matrix : str
    Path to the transformation matrix file
path_meta_cell_micron : str
    Path to the meta cell file with coordinates in microns
path_meta_cell_image : str
    Path to save the meta cell file with coordinates in pixels</p>
<h4 id="celldega.pre.make_meta_cell_image_coord--returns">Returns</h4>
<p>None</p>
<h4 id="celldega.pre.make_meta_cell_image_coord--examples">Examples</h4>
<blockquote>
<blockquote>
<blockquote>
<p>make_meta_cell_image_coord(
...     technology='Xenium',
...     path_transformation_matrix='data/transformation_matrix.txt',
...     path_meta_cell_micron='data/meta_cell_micron.csv',
...     path_meta_cell_image='data/meta_cell_image.parquet'
... )</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_meta_cell_image_coord</span><span class="p">(</span>
    <span class="n">technology</span><span class="p">,</span>
    <span class="n">path_transformation_matrix</span><span class="p">,</span>
    <span class="n">path_meta_cell_micron</span><span class="p">,</span>
    <span class="n">path_meta_cell_image</span><span class="p">,</span>
    <span class="n">image_scale</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply an affine transformation to the cell coordinates in microns and save</span>
<span class="sd">    the transformed coordinates in pixels</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    technology : str</span>
<span class="sd">        The technology used to generate the data, Xenium and MERSCOPE are supported.</span>
<span class="sd">    path_transformation_matrix : str</span>
<span class="sd">        Path to the transformation matrix file</span>
<span class="sd">    path_meta_cell_micron : str</span>
<span class="sd">        Path to the meta cell file with coordinates in microns</span>
<span class="sd">    path_meta_cell_image : str</span>
<span class="sd">        Path to save the meta cell file with coordinates in pixels</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; make_meta_cell_image_coord(</span>
<span class="sd">    ...     technology=&#39;Xenium&#39;,</span>
<span class="sd">    ...     path_transformation_matrix=&#39;data/transformation_matrix.txt&#39;,</span>
<span class="sd">    ...     path_meta_cell_micron=&#39;data/meta_cell_micron.csv&#39;,</span>
<span class="sd">    ...     path_meta_cell_image=&#39;data/meta_cell_image.parquet&#39;</span>
<span class="sd">    ... )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">transformation_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">path_transformation_matrix</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="k">if</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;MERSCOPE&quot;</span><span class="p">:</span>
        <span class="n">meta_cell</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_meta_cell_micron</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;EntityID&quot;</span><span class="p">,</span> <span class="s2">&quot;center_x&quot;</span><span class="p">,</span> <span class="s2">&quot;center_y&quot;</span><span class="p">])</span>
        <span class="n">meta_cell</span> <span class="o">=</span> <span class="n">convert_long_id_to_short</span><span class="p">(</span><span class="n">meta_cell</span><span class="p">)</span>
        <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;cell_id&quot;</span><span class="p">]</span>
        <span class="n">meta_cell</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;cell_id&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;Xenium&quot;</span><span class="p">:</span>
        <span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cell_id&quot;</span><span class="p">,</span> <span class="s2">&quot;x_centroid&quot;</span><span class="p">,</span> <span class="s2">&quot;y_centroid&quot;</span><span class="p">]</span>
        <span class="n">meta_cell</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_meta_cell_micron</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">)</span>
        <span class="n">meta_cell</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">,</span> <span class="s2">&quot;center_y&quot;</span><span class="p">]</span>
        <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">meta_cell</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">meta_cell</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># Adding a ones column to accommodate for affine transformation</span>
    <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;ones&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Preparing the data for matrix multiplication</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="p">[[</span><span class="s2">&quot;center_x&quot;</span><span class="p">,</span> <span class="s2">&quot;center_y&quot;</span><span class="p">,</span> <span class="s2">&quot;ones&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Applying the transformation matrix</span>
    <span class="n">transformed_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">transformation_matrix</span><span class="p">,</span> <span class="n">points</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Updating the DataFrame with transformed coordinates</span>
    <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Dropping the ones column as it&#39;s no longer needed</span>
    <span class="n">meta_cell</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ones&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">image_scale</span>
    <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">image_scale</span>

    <span class="n">meta_cell</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;center_x&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;center_y&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;MERSCOPE&quot;</span><span class="p">:</span>
        <span class="n">meta_cell</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="p">[[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;EntityID&quot;</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">meta_cell</span> <span class="o">=</span> <span class="n">meta_cell</span><span class="p">[[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>


    <span class="n">meta_cell</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">path_meta_cell_image</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.make_meta_gene" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_meta_gene</span><span class="p">(</span><span class="n">technology</span><span class="p">,</span> <span class="n">path_cbg</span><span class="p">,</span> <span class="n">path_output</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Create a DataFrame with genes and their assigned colors</p>
<h4 id="celldega.pre.make_meta_gene--parameters">Parameters</h4>
<p>technology : str
    The technology used to generate the data, Xenium and MERSCOPE are supported.
path_cbg : str
    Path to the cell-by-gene matrix data (the data format can vary based on technology)
path_output : str
    Path to save the meta gene file</p>
<h4 id="celldega.pre.make_meta_gene--returns">Returns</h4>
<p>None</p>
<h4 id="celldega.pre.make_meta_gene--examples">Examples</h4>
<blockquote>
<blockquote>
<blockquote>
<p>make_meta_gene(
...     technology='Xenium',
...     path_cbg='data/',
...     path_output='data/meta_gene.parquet'
... )</p>
</blockquote>
</blockquote>
</blockquote>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_meta_gene</span><span class="p">(</span><span class="n">technology</span><span class="p">,</span> <span class="n">path_cbg</span><span class="p">,</span> <span class="n">path_output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a DataFrame with genes and their assigned colors</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    technology : str</span>
<span class="sd">        The technology used to generate the data, Xenium and MERSCOPE are supported.</span>
<span class="sd">    path_cbg : str</span>
<span class="sd">        Path to the cell-by-gene matrix data (the data format can vary based on technology)</span>
<span class="sd">    path_output : str</span>
<span class="sd">        Path to save the meta gene file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; make_meta_gene(</span>
<span class="sd">    ...     technology=&#39;Xenium&#39;,</span>
<span class="sd">    ...     path_cbg=&#39;data/&#39;,</span>
<span class="sd">    ...     path_output=&#39;data/meta_gene.parquet&#39;</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;MERSCOPE&quot;</span><span class="p">:</span>
        <span class="n">cbg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_cbg</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">genes</span> <span class="o">=</span> <span class="n">cbg</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;Xenium&quot;</span><span class="p">:</span>
        <span class="c1"># genes = pd.read_csv(path_cbg + &#39;features.tsv.gz&#39;, sep=&#39;\t&#39;, header=None)[1].values.tolist()</span>
        <span class="n">cbg</span> <span class="o">=</span> <span class="n">read_cbg_mtx</span><span class="p">(</span><span class="n">path_cbg</span><span class="p">)</span>
        <span class="n">genes</span> <span class="o">=</span> <span class="n">cbg</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># Get all categorical color palettes from Matplotlib and flatten them into a single list of colors</span>
    <span class="n">palettes</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">colors</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">colormaps</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;tab&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]</span>
    <span class="n">flat_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span> <span class="k">for</span> <span class="n">palette</span> <span class="ow">in</span> <span class="n">palettes</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">palette</span><span class="p">]</span>

    <span class="c1"># Convert RGB tuples to hex codes</span>
    <span class="n">flat_colors_hex</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_hex</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">flat_colors</span><span class="p">]</span>

    <span class="c1"># Use modular arithmetic to assign a color to each gene, white for genes with &quot;Blank&quot;</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">flat_colors_hex</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">flat_colors_hex</span><span class="p">)]</span> <span class="k">if</span> <span class="s2">&quot;Blank&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gene</span> <span class="k">else</span> <span class="s2">&quot;#FFFFFF&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">genes</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Create a DataFrame with genes and their assigned colors</span>
    <span class="n">ser_color</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">genes</span><span class="p">)</span>

    <span class="c1"># calculate gene expression metadata</span>
    <span class="n">meta_gene</span> <span class="o">=</span> <span class="n">calc_meta_gene_data</span><span class="p">(</span><span class="n">cbg</span><span class="p">)</span>
    <span class="n">meta_gene</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ser_color</span>

    <span class="c1"># Identify sparse columns</span>
    <span class="n">sparse_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">meta_gene</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">(</span><span class="n">meta_gene</span><span class="p">[</span><span class="n">col</span><span class="p">])]</span>

    <span class="c1"># Convert sparse columns to dense</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">sparse_cols</span><span class="p">:</span>
        <span class="n">meta_gene</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_gene</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">to_dense</span><span class="p">()</span>

    <span class="n">meta_gene</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">path_output</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.make_trx_tiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_trx_tiles</span><span class="p">(</span><span class="n">technology</span><span class="p">,</span> <span class="n">path_trx</span><span class="p">,</span> <span class="n">path_transformation_matrix</span><span class="p">,</span> <span class="n">path_trx_tiles</span><span class="p">,</span> <span class="n">coarse_tile_factor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Processes transcript data by dividing it into coarse-grain and fine-grain tiles,
applying transformations, and saving the results in a parallelized manner.</p>
<h4 id="celldega.pre.make_trx_tiles--parameters">Parameters</h4>
<p>technology : str
    The technology used for generating the transcript data (e.g., "MERSCOPE" or "Xenium").
path_trx : str
    Path to the file containing the transcript data.
path_transformation_matrix : str
    Path to the file containing the transformation matrix (CSV file).
path_trx_tiles : str
    Directory path where the output files (Parquet files) for each tile will be saved.
coarse_tile_factor : int, optional
    Scaling factor of each coarse-grain tile comparing to the fine tile size.
tile_size : int, optional
    Size of each fine-grain tile in microns (default is 250).
chunk_size : int, optional
    Number of rows to process per chunk for memory efficiency (default is 1000000).
verbose : bool, optional
    Flag to enable verbose output (default is False).
image_scale : float, optional
    Scale factor to apply to the transcript coordinates (default is 0.5).
max_workers : int, optional
    Maximum number of parallel workers for processing tiles (default is 8).</p>
<h4 id="celldega.pre.make_trx_tiles--returns">Returns</h4>
<p>dict
    A dictionary containing the bounds of the processed data in both x and y directions.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/trx_tile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_trx_tiles</span><span class="p">(</span>
    <span class="n">technology</span><span class="p">,</span>
    <span class="n">path_trx</span><span class="p">,</span>
    <span class="n">path_transformation_matrix</span><span class="p">,</span>
    <span class="n">path_trx_tiles</span><span class="p">,</span>
    <span class="n">coarse_tile_factor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">tile_size</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">image_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes transcript data by dividing it into coarse-grain and fine-grain tiles,</span>
<span class="sd">    applying transformations, and saving the results in a parallelized manner.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    technology : str</span>
<span class="sd">        The technology used for generating the transcript data (e.g., &quot;MERSCOPE&quot; or &quot;Xenium&quot;).</span>
<span class="sd">    path_trx : str</span>
<span class="sd">        Path to the file containing the transcript data.</span>
<span class="sd">    path_transformation_matrix : str</span>
<span class="sd">        Path to the file containing the transformation matrix (CSV file).</span>
<span class="sd">    path_trx_tiles : str</span>
<span class="sd">        Directory path where the output files (Parquet files) for each tile will be saved.</span>
<span class="sd">    coarse_tile_factor : int, optional</span>
<span class="sd">        Scaling factor of each coarse-grain tile comparing to the fine tile size.</span>
<span class="sd">    tile_size : int, optional</span>
<span class="sd">        Size of each fine-grain tile in microns (default is 250).</span>
<span class="sd">    chunk_size : int, optional</span>
<span class="sd">        Number of rows to process per chunk for memory efficiency (default is 1000000).</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Flag to enable verbose output (default is False).</span>
<span class="sd">    image_scale : float, optional</span>
<span class="sd">        Scale factor to apply to the transcript coordinates (default is 0.5).</span>
<span class="sd">    max_workers : int, optional</span>
<span class="sd">        Maximum number of parallel workers for processing tiles (default is 8).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary containing the bounds of the processed data in both x and y directions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">process_coarse_tile</span><span class="p">(</span><span class="n">trx</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coarse_tile_x_min</span><span class="p">,</span> <span class="n">coarse_tile_x_max</span><span class="p">,</span> <span class="n">coarse_tile_y_min</span><span class="p">,</span> <span class="n">coarse_tile_y_max</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">,</span> <span class="n">path_trx_tiles</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">n_fine_tiles_x</span><span class="p">,</span> <span class="n">n_fine_tiles_y</span><span class="p">,</span> <span class="n">max_workers</span><span class="p">):</span>
        <span class="c1"># Filter the entire dataset for the current coarse tile</span>
        <span class="n">coarse_tile</span> <span class="o">=</span> <span class="n">trx</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_x&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">coarse_tile_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_x&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">coarse_tile_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_y&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">coarse_tile_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_y&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">coarse_tile_y_max</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">coarse_tile</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="c1"># Now process fine tiles using global fine tile indices</span>
            <span class="n">process_fine_tiles</span><span class="p">(</span><span class="n">coarse_tile</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coarse_tile_x_min</span><span class="p">,</span> <span class="n">coarse_tile_x_max</span><span class="p">,</span> <span class="n">coarse_tile_y_min</span><span class="p">,</span> <span class="n">coarse_tile_y_max</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">,</span> <span class="n">path_trx_tiles</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">n_fine_tiles_x</span><span class="p">,</span> <span class="n">n_fine_tiles_y</span><span class="p">,</span> <span class="n">max_workers</span><span class="p">)</span>   


    <span class="k">def</span> <span class="nf">process_fine_tiles</span><span class="p">(</span><span class="n">coarse_tile</span><span class="p">,</span> <span class="n">coarse_i</span><span class="p">,</span> <span class="n">coarse_j</span><span class="p">,</span> <span class="n">coarse_tile_x_min</span><span class="p">,</span> <span class="n">coarse_tile_x_max</span><span class="p">,</span> <span class="n">coarse_tile_y_min</span><span class="p">,</span> <span class="n">coarse_tile_y_max</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">,</span> <span class="n">path_trx_tiles</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">n_fine_tiles_x</span><span class="p">,</span> <span class="n">n_fine_tiles_y</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>

        <span class="c1"># Use ThreadPoolExecutor for parallel processing of fine-grain tiles within the coarse tile</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Iterate over fine-grain tiles within the global bounds</span>
            <span class="k">for</span> <span class="n">fine_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_fine_tiles_x</span><span class="p">):</span>
                <span class="n">fine_tile_x_min</span> <span class="o">=</span> <span class="n">x_min</span> <span class="o">+</span> <span class="n">fine_i</span> <span class="o">*</span> <span class="n">tile_size</span>
                <span class="n">fine_tile_x_max</span> <span class="o">=</span> <span class="n">fine_tile_x_min</span> <span class="o">+</span> <span class="n">tile_size</span>

                <span class="c1"># Process only if the fine tile falls within the current coarse tile&#39;s bounds</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fine_tile_x_min</span> <span class="o">&gt;=</span> <span class="n">coarse_tile_x_min</span> <span class="ow">and</span> <span class="n">fine_tile_x_max</span> <span class="o">&lt;=</span> <span class="n">coarse_tile_x_max</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">for</span> <span class="n">fine_j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_fine_tiles_y</span><span class="p">):</span>
                    <span class="n">fine_tile_y_min</span> <span class="o">=</span> <span class="n">y_min</span> <span class="o">+</span> <span class="n">fine_j</span> <span class="o">*</span> <span class="n">tile_size</span>
                    <span class="n">fine_tile_y_max</span> <span class="o">=</span> <span class="n">fine_tile_y_min</span> <span class="o">+</span> <span class="n">tile_size</span>

                    <span class="c1"># Process only if the fine tile falls within the current coarse tile&#39;s bounds</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fine_tile_y_min</span> <span class="o">&gt;=</span> <span class="n">coarse_tile_y_min</span> <span class="ow">and</span> <span class="n">fine_tile_y_max</span> <span class="o">&lt;=</span> <span class="n">coarse_tile_y_max</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="c1"># Submit the task for each fine tile to process in parallel</span>
                    <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                        <span class="n">filter_and_save_fine_tile</span><span class="p">,</span> <span class="n">coarse_tile</span><span class="p">,</span> <span class="n">coarse_i</span><span class="p">,</span> <span class="n">coarse_j</span><span class="p">,</span> <span class="n">fine_i</span><span class="p">,</span> <span class="n">fine_j</span><span class="p">,</span> 
                        <span class="n">fine_tile_x_min</span><span class="p">,</span> <span class="n">fine_tile_x_max</span><span class="p">,</span> <span class="n">fine_tile_y_min</span><span class="p">,</span> <span class="n">fine_tile_y_max</span><span class="p">,</span> <span class="n">path_trx_tiles</span>
                    <span class="p">))</span>

            <span class="c1"># Wait for all futures to complete</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
                <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c1"># Raise exceptions if any occurred during execution</span>


    <span class="k">def</span> <span class="nf">filter_and_save_fine_tile</span><span class="p">(</span><span class="n">coarse_tile</span><span class="p">,</span> <span class="n">coarse_i</span><span class="p">,</span> <span class="n">coarse_j</span><span class="p">,</span> <span class="n">fine_i</span><span class="p">,</span> <span class="n">fine_j</span><span class="p">,</span> <span class="n">fine_tile_x_min</span><span class="p">,</span> <span class="n">fine_tile_x_max</span><span class="p">,</span> <span class="n">fine_tile_y_min</span><span class="p">,</span> <span class="n">fine_tile_y_max</span><span class="p">,</span> <span class="n">path_trx_tiles</span><span class="p">):</span>

        <span class="c1"># Filter the coarse tile for the current fine tile&#39;s boundaries</span>
        <span class="n">fine_tile_trx</span> <span class="o">=</span> <span class="n">coarse_tile</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_x&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">fine_tile_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_x&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fine_tile_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_y&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">fine_tile_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_y&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fine_tile_y_max</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fine_tile_trx</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            <span class="c1"># Add geometry column as a list of [x, y] pairs</span>
            <span class="n">fine_tile_trx</span> <span class="o">=</span> <span class="n">fine_tile_trx</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
                <span class="n">pl</span><span class="o">.</span><span class="n">concat_list</span><span class="p">([</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_x&quot;</span><span class="p">),</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_y&quot;</span><span class="p">)])</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;transformed_x&#39;</span><span class="p">,</span> <span class="s1">&#39;transformed_y&#39;</span><span class="p">])</span>

            <span class="c1"># Define the filename based on fine tile coordinates</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_trx_tiles</span><span class="si">}</span><span class="s2">/transcripts_tile_</span><span class="si">{</span><span class="n">fine_i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fine_j</span><span class="si">}</span><span class="s2">.parquet&quot;</span>

            <span class="c1"># Save the filtered DataFrame to a Parquet file</span>
            <span class="n">fine_tile_trx</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>


    <span class="c1"># Load transformation matrix</span>
    <span class="n">transformation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">path_transformation_matrix</span><span class="p">)</span>

    <span class="c1"># Load the transcript data based on the technology using Polars</span>
    <span class="k">if</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;MERSCOPE&quot;</span><span class="p">:</span>
        <span class="n">trx_ini</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_trx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="s2">&quot;global_x&quot;</span><span class="p">,</span> <span class="s2">&quot;global_y&quot;</span><span class="p">])</span>
        <span class="n">trx_ini</span> <span class="o">=</span> <span class="n">trx_ini</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;global_x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;global_y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">),</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;gene&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="p">])</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">technology</span> <span class="o">==</span> <span class="s2">&quot;Xenium&quot;</span><span class="p">:</span>
        <span class="n">trx_ini</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">path_trx</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">([</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;feature_name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;x_location&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span>
            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;y_location&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="p">])</span>

    <span class="c1"># Process the data in chunks and apply transformations</span>
    <span class="n">all_chunks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">start_row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">trx_ini</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing chunks&quot;</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">trx_ini</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>

        <span class="c1"># Apply transformation matrix to the coordinates</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">chunk</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">chunk</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">1</span><span class="p">))])</span>
        <span class="n">transformed_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">transformation_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Create new transformed columns and drop original x, y columns</span>
        <span class="n">transformed_chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">with_columns</span><span class="p">([</span>
            <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">transformed_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;transformed_x&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">transformed_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;transformed_y&quot;</span><span class="p">)</span>
        <span class="p">])</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
        <span class="n">all_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transformed_chunk</span><span class="p">)</span>

    <span class="c1"># Concatenate all chunks after processing</span>
    <span class="n">trx</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_chunks</span><span class="p">)</span>

    <span class="c1"># Ensure the output directory exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_trx_tiles</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_trx_tiles</span><span class="p">)</span>

    <span class="c1"># Get min and max x, y values</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">trx</span><span class="o">.</span><span class="n">select</span><span class="p">([</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;x_min&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;x_max&quot;</span><span class="p">)</span>
    <span class="p">])</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">trx</span><span class="o">.</span><span class="n">select</span><span class="p">([</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;y_min&quot;</span><span class="p">),</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;transformed_y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;y_max&quot;</span><span class="p">)</span>
    <span class="p">])</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate the number of fine-grain tiles globally</span>
    <span class="n">n_fine_tiles_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">tile_size</span><span class="p">))</span>
    <span class="n">n_fine_tiles_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">tile_size</span><span class="p">))</span>

    <span class="c1"># Calculate the number of coarse-grain tiles</span>
    <span class="n">n_coarse_tiles_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)))</span>
    <span class="n">n_coarse_tiles_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)))</span>

    <span class="c1"># Use ThreadPoolExecutor for parallel processing of coarse-grain tiles</span>
    <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_coarse_tiles_x</span><span class="p">):</span>
            <span class="n">coarse_tile_x_min</span> <span class="o">=</span> <span class="n">x_min</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>
            <span class="n">coarse_tile_x_max</span> <span class="o">=</span> <span class="n">coarse_tile_x_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_coarse_tiles_y</span><span class="p">):</span>
                <span class="n">coarse_tile_y_min</span> <span class="o">=</span> <span class="n">y_min</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>
                <span class="n">coarse_tile_y_max</span> <span class="o">=</span> <span class="n">coarse_tile_y_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">coarse_tile_factor</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>

                <span class="c1"># Submit each coarse tile for parallel processing</span>
                <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="n">process_coarse_tile</span><span class="p">,</span> <span class="n">trx</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">coarse_tile_x_min</span><span class="p">,</span> <span class="n">coarse_tile_x_max</span><span class="p">,</span> <span class="n">coarse_tile_y_min</span><span class="p">,</span> <span class="n">coarse_tile_y_max</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">,</span> <span class="n">path_trx_tiles</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">n_fine_tiles_x</span><span class="p">,</span> <span class="n">n_fine_tiles_y</span><span class="p">,</span> <span class="n">max_workers</span>
                <span class="p">))</span>

        <span class="c1"># Wait for all coarse tiles to complete</span>
        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing coarse tiles&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;tile&quot;</span><span class="p">):</span>
            <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c1"># Raise exceptions if any occurred during execution</span>

    <span class="c1"># Return the tile bounds</span>
    <span class="n">tile_bounds</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;x_min&quot;</span><span class="p">:</span> <span class="n">x_min</span><span class="p">,</span>
        <span class="s2">&quot;x_max&quot;</span><span class="p">:</span> <span class="n">x_max</span><span class="p">,</span>
        <span class="s2">&quot;y_min&quot;</span><span class="p">:</span> <span class="n">y_min</span><span class="p">,</span>
        <span class="s2">&quot;y_max&quot;</span><span class="p">:</span> <span class="n">y_max</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">tile_bounds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.read_cbg_mtx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_cbg_mtx</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Read the cell-by-gene matrix from the mtx files.</p>
<h4 id="celldega.pre.read_cbg_mtx--parameters">Parameters</h4>
<p>base_path : str
    The base path to the directory containing the mtx files.</p>
<h4 id="celldega.pre.read_cbg_mtx--returns">Returns</h4>
<p>cbg : pandas.DataFrame
    A sparse DataFrame with genes as columns and barcodes as rows.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/landscape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_cbg_mtx</span><span class="p">(</span><span class="n">base_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the cell-by-gene matrix from the mtx files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    base_path : str</span>
<span class="sd">        The base path to the directory containing the mtx files.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cbg : pandas.DataFrame</span>
<span class="sd">        A sparse DataFrame with genes as columns and barcodes as rows.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading mtx file from &quot;</span><span class="p">,</span> <span class="n">base_path</span><span class="p">)</span>

    <span class="c1"># File paths</span>
    <span class="n">barcodes_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="s2">&quot;barcodes.tsv.gz&quot;</span><span class="p">)</span>
    <span class="n">features_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="s2">&quot;features.tsv.gz&quot;</span><span class="p">)</span>
    <span class="n">matrix_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="s2">&quot;matrix.mtx.gz&quot;</span><span class="p">)</span>

    <span class="c1"># Read barcodes and features</span>
    <span class="n">barcodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">barcodes_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">features_path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Read the gene expression matrix and transpose it</span>
    <span class="c1"># Transpose and convert to CSC format for fast column slicing</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">mmread</span><span class="p">(</span><span class="n">matrix_path</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">tocsc</span><span class="p">()</span>

    <span class="c1"># Create a sparse DataFrame with genes as columns and barcodes as rows</span>
    <span class="n">cbg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">from_spmatrix</span><span class="p">(</span>
        <span class="n">matrix</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">barcodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">cbg</span> <span class="o">=</span> <span class="n">cbg</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;__index_level_0__&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cbg</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.reduce_image_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reduce_image_size</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">scale_image</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">path_landscape_files</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <h4 id="celldega.pre.reduce_image_size--parameters">Parameters</h4>
<p>image_path : str
    Path to the image file
scale_image : float (default=0.5)
    Scale factor for the image resize</p>
<h4 id="celldega.pre.reduce_image_size--returns">Returns</h4>
<p>new_image_path : str
    Path to the resized image file</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reduce_image_size</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">scale_image</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">path_landscape_files</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    image_path : str</span>
<span class="sd">        Path to the image file</span>
<span class="sd">    scale_image : float (default=0.5)</span>
<span class="sd">        Scale factor for the image resize</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_image_path : str</span>
<span class="sd">        Path to the resized image file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">pyvips</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new_from_file</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s2">&quot;sequential&quot;</span><span class="p">)</span>

    <span class="n">resized_image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">scale_image</span><span class="p">)</span>

    <span class="n">new_image_name</span> <span class="o">=</span> <span class="n">image_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;_downsize.tif&quot;</span><span class="p">)</span>
    <span class="n">new_image_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_landscape_files</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">new_image_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">resized_image</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="n">new_image_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_image_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.save_cbg_gene_parquets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_cbg_gene_parquets</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">cbg</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Save the cell-by-gene matrix as gene-specific Parquet files.</p>
<h4 id="celldega.pre.save_cbg_gene_parquets--parameters">Parameters</h4>
<p>base_path : str
    The base path to the parent directory containing the landscape_files directory.
cbg : pandas.DataFrame
    A sparse DataFrame with genes as columns and barcodes as rows.
verbose : bool, optional
    Whether to print progress information, by default False.</p>
<h4 id="celldega.pre.save_cbg_gene_parquets--returns">Returns</h4>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/landscape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_cbg_gene_parquets</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">cbg</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the cell-by-gene matrix as gene-specific Parquet files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    base_path : str</span>
<span class="sd">        The base path to the parent directory containing the landscape_files directory.</span>
<span class="sd">    cbg : pandas.DataFrame</span>
<span class="sd">        A sparse DataFrame with genes as columns and barcodes as rows.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        Whether to print progress information, by default False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="s2">&quot;cbg&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cbg</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing gene </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">gene</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract the column as a DataFrame as a copy</span>
        <span class="n">col_df</span> <span class="o">=</span> <span class="n">cbg</span><span class="p">[[</span><span class="n">gene</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Convert to dense and integer type</span>
        <span class="n">col_df</span> <span class="o">=</span> <span class="n">col_df</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">to_dense</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Create a DataFrame necessary to prevent error in to_parquet</span>
        <span class="n">inst_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">col_df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">gene</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">col_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Replace 0 with NA and drop rows where all values are NA</span>
        <span class="n">inst_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">inst_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Save to Parquet if DataFrame is not empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inst_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gene</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">)</span>
            <span class="n">inst_df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="celldega.pre.save_landscape_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_landscape_parameters</span><span class="p">(</span><span class="n">technology</span><span class="p">,</span> <span class="n">path_landscape_files</span><span class="p">,</span> <span class="n">image_name</span><span class="o">=</span><span class="s1">&#39;dapi_files&#39;</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">image_info</span><span class="o">=</span><span class="p">{},</span> <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;.webp&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Save the landscape parameters to a JSON file.</p>

            <details class="quote">
              <summary>Source code in <code>src/celldega/pre/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_landscape_parameters</span><span class="p">(</span>
    <span class="n">technology</span><span class="p">,</span> <span class="n">path_landscape_files</span><span class="p">,</span> <span class="n">image_name</span><span class="o">=</span><span class="s2">&quot;dapi_files&quot;</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">image_info</span><span class="o">=</span><span class="p">{},</span> <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;.webp&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the landscape parameters to a JSON file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path_image_pyramid</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_landscape_files</span><span class="si">}</span><span class="s2">/pyramid_images/</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">path_image_pyramid</span><span class="p">)</span>

    <span class="n">max_pyramid_zoom</span> <span class="o">=</span> <span class="n">get_max_zoom_level</span><span class="p">(</span><span class="n">path_image_pyramid</span><span class="p">)</span>

    <span class="n">landscape_parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;technology&quot;</span><span class="p">:</span> <span class="n">technology</span><span class="p">,</span>
        <span class="s2">&quot;max_pyramid_zoom&quot;</span><span class="p">:</span> <span class="n">max_pyramid_zoom</span><span class="p">,</span>
        <span class="s2">&quot;tile_size&quot;</span><span class="p">:</span> <span class="n">tile_size</span><span class="p">,</span>
        <span class="s2">&quot;image_info&quot;</span><span class="p">:</span> <span class="n">image_info</span><span class="p">,</span>
        <span class="s2">&quot;image_format&quot;</span><span class="p">:</span> <span class="n">image_format</span>
    <span class="p">}</span>

    <span class="n">path_landscape_parameters</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_landscape_files</span><span class="si">}</span><span class="s2">/landscape_parameters.json&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_landscape_parameters</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">landscape_parameters</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="celldega.viz"></a>
    <div class="doc doc-contents first">

      <p>Module for visualization</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="celldega.viz.Landscape" class="doc doc-heading">
            <code>Landscape</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="anywidget.AnyWidget">AnyWidget</span></code></p>


      <p>A widget for interactive visualization of spatial omics data. This widget
currently supports iST (Xenium and MERSCOPE) and sST (Visium HD data)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ini_x</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial x-coordinate of the view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ini_y</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial y-coordinate of the view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>ini_zoom</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial zoom level of the view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>token</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token traitlet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>base_url</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The base URL for the widget.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dataset_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the dataset to visualize. This will show up in the user interface bar.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.component">component</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the component.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.technology">technology</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The technology used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.base_url">base_url</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The base URL for the widget.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.token">token</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token traitlet.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.ini_x">ini_x</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial x-coordinate of the view.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.ini_y">ini_y</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial y-coordinate of the view.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.ini_z">ini_z</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial z-coordinate of the view.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.ini_zoom">ini_zoom</span></code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial zoom level of the view.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.dataset_name">dataset_name</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the dataset to visualize.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.update_trigger">update_trigger</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary to trigger updates.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Landscape.cell_clusters">cell_clusters</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary containing cell cluster information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Landscape</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A widget for visualizing a 'landscape' view of spatial omics data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/celldega/viz/widget.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Landscape</span><span class="p">(</span><span class="n">anywidget</span><span class="o">.</span><span class="n">AnyWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A widget for interactive visualization of spatial omics data. This widget</span>
<span class="sd">    currently supports iST (Xenium and MERSCOPE) and sST (Visium HD data)</span>

<span class="sd">    Args:</span>
<span class="sd">        ini_x (float): The initial x-coordinate of the view.</span>
<span class="sd">        ini_y (float): The initial y-coordinate of the view.</span>
<span class="sd">        ini_zoom (float): The initial zoom level of the view.</span>
<span class="sd">        token (str): The token traitlet.</span>
<span class="sd">        base_url (str): The base URL for the widget.</span>
<span class="sd">        dataset_name (str, optional): The name of the dataset to visualize. This will show up in the user interface bar.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        component (str): The name of the component.</span>
<span class="sd">        technology (str): The technology used.</span>
<span class="sd">        base_url (str): The base URL for the widget.</span>
<span class="sd">        token (str): The token traitlet.</span>
<span class="sd">        ini_x (float): The initial x-coordinate of the view.</span>
<span class="sd">        ini_y (float): The initial y-coordinate of the view.</span>
<span class="sd">        ini_z (float): The initial z-coordinate of the view.</span>
<span class="sd">        ini_zoom (float): The initial zoom level of the view.</span>
<span class="sd">        dataset_name (str): The name of the dataset to visualize.</span>
<span class="sd">        update_trigger (dict): The dictionary to trigger updates.</span>
<span class="sd">        cell_clusters (dict): The dictionary containing cell cluster information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Landscape: A widget for visualizing a &#39;landscape&#39; view of spatial omics data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_esm</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;../static&quot;</span> <span class="o">/</span> <span class="s2">&quot;widget.js&quot;</span>
    <span class="n">_css</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;../static&quot;</span> <span class="o">/</span> <span class="s2">&quot;widget.css&quot;</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;Landscape&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">technology</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;sst&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ini_x</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ini_y</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ini_z</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ini_zoom</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">square_tile_size</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="mf">1.4</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">({})</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nbhd</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">({})</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">update_trigger</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cell_clusters</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">width</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">800</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trigger_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="c1"># This method updates the update_trigger traitlet with a new value</span>
        <span class="c1"># You can pass any information necessary for the update, or just a timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trigger</span> <span class="o">=</span> <span class="n">new_value</span>

    <span class="k">def</span> <span class="nf">update_cell_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_clusters</span><span class="p">):</span>
        <span class="c1"># Convert the new_clusters to a JSON serializable format if necessary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_clusters</span> <span class="o">=</span> <span class="n">new_clusters</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="celldega.viz.Matrix" class="doc doc-heading">
            <code>Matrix</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="anywidget.AnyWidget">AnyWidget</span></code></p>


      <p>A widget for interactive visualization of a hierarchically clustered matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>value</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value traitlet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>component</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The component traitlet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>network</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The network traitlet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>click_info</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The click_info traitlet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Matrix.component">component</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the component.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Matrix.network">network</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The network dictionary.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="celldega.viz.Matrix.click_info">click_info</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The click_info dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Matrix</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A widget for visualizing a hierarchically clustered matrix.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/celldega/viz/widget.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Matrix</span><span class="p">(</span><span class="n">anywidget</span><span class="o">.</span><span class="n">AnyWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A widget for interactive visualization of a hierarchically clustered matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        value (int): The value traitlet.</span>
<span class="sd">        component (str): The component traitlet.</span>
<span class="sd">        network (dict): The network traitlet.</span>
<span class="sd">        click_info (dict): The click_info traitlet.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        component (str): The name of the component.</span>
<span class="sd">        network (dict): The network dictionary.</span>
<span class="sd">        click_info (dict): The click_info dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Matrix: A widget for visualizing a hierarchically clustered matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_esm</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;../static&quot;</span> <span class="o">/</span> <span class="s2">&quot;widget.js&quot;</span>
    <span class="n">_css</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;../static&quot;</span> <span class="o">/</span> <span class="s2">&quot;widget.css&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Unicode</span><span class="p">(</span><span class="s2">&quot;Matrix&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">({})</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">click_info</span> <span class="o">=</span> <span class="n">traitlets</span><span class="o">.</span><span class="n">Dict</span><span class="p">({})</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/broadinstitute/celldega" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://bsky.app/profile/stp-broad.bsky.social" target="_blank" rel="noopener" title="bsky.app" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M407.8 294.7c-3.3-.4-6.7-.8-10-1.3 3.4.4 6.7.9 10 1.3zM288 227.1c-26.1-50.7-97.1-145.2-163.1-191.8C61.6-9.4 37.5-1.7 21.6 5.5 3.3 13.8 0 41.9 0 58.4S9.1 194 15 213.9c19.5 65.7 89.1 87.9 153.2 80.7 3.3-.5 6.6-.9 10-1.4-3.3.5-6.6 1-10 1.4-93.9 14-177.3 48.2-67.9 169.9C220.6 589.1 265.1 437.8 288 361.1c22.9 76.7 49.2 222.5 185.6 103.4 102.4-103.4 28.1-156-65.8-169.9-3.3-.4-6.7-.8-10-1.3 3.4.4 6.7.9 10 1.3 64.1 7.1 133.6-15.1 153.2-80.7C566.9 194 576 75 576 58.4s-3.3-44.7-21.6-52.9c-15.8-7.1-40-14.9-103.2 29.8C385.1 81.9 314.1 176.4 288 227.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../assets/js/index.js" type="module"></script>
      
        <script src="../../assets/js/gallery_mouse_brain.js" type="module"></script>
      
        <script src="../../assets/js/gallery_skin_cancer.js" type="module"></script>
      
        <script src="../../assets/js/google-analytics.js"></script>
      
        <script src="../../assets/js/hide_notebook_sidebar.js" type="module"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>